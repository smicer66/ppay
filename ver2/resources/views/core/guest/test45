var maxOrder = 31;
var minOrder = 9;

function addNewPersonnel(id, companyname, personnelIdEdit, domainCoopId, currentUserCoopId, currentUserRole)
{
	//$( "#newCompany" ).show('slow', 'swing');
	$.ajax({
			type: "GET",
			url: "/api/cooperative-listing",
			data: [],
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					var companyList = data.companyList;
					$('.cooperativeList').empty();
					coopList = $('.cooperativeList');
					coopList.each(function(){
						$(this).empty();
						$(this).append($('<option>', {
							value: null,
							text : '--Select A Cooperative--'
						}));
						var coop = $(this);
						$.each(companyList, function(key, value) {
							console.log(value);
							//console.log(key);

							if(domainCoopId!=undefined && domainCoopId!=null && value.parentCompanyId!=undefined && value.parentCompanyId!=null && (domainCoopId==value.id || domainCoopId==value.parentCompanyId))
							{
								if(currentUserCoopId!=undefined && currentUserCoopId!=null && currentUserCoopId==domainCoopId)
								{
									console.log(1);
									coop.append($('<option>', {
										value: value.id,
										text : value.companyName,
										selected: value.id==id ? true : false
									}));
								}
								else
								{
									if(currentUserCoopId!=undefined && currentUserCoopId!=null && currentUserCoopId==value.id)
									{
										console.log(2);
										coop.append($('<option>', {
											value: value.id,
											text : value.companyName,
											selected: value.id==id ? true : false
										}));
									}
								}
							}
							else
							{
								if(domainCoopId!=undefined && domainCoopId!=null)
								{
									if(currentUserCoopId!=undefined && currentUserCoopId!=null && currentUserCoopId==value.id)
									{
										console.log(3);
										coop.append($('<option>', {
											value: value.id,
											text : value.companyName,
											selected: value.id==id ? true : false
										}));
									}
								}
								else
								{
									if(currentUserRole!=undefined && currentUserRole!=null && currentUserRole=='SUPER ADMIN')
									{
										console.log(4);
										coop.append($('<option>', {
											value: value.id,
											text : value.companyName,
											selected: value.id==id ? true : false
										}));
									}
									else
									{
										if(currentUserCoopId!=undefined && currentUserCoopId!=null && currentUserCoopId==value.id)
										{
											console.log(5);
											coop.append($('<option>', {
												value: value.id,
												text : value.companyName,
												selected: value.id==id ? true : false
											}));
										}
									}
								}
							}

						});
					});
					/*for(var t=0; t<coopList.length; t++)
					{
						var cop = coopList[t];
						cop.append($('<option>', {
							value: null,
							text : '--Select A Cooperative--'
						}));
						$.each(companyList, function(key, value) {
							console.log(value);
							console.log(key);
							cop.append($('<option>', {
								value: value.id,
								text : value.companyName,
								selected: value.id==id ? true : false
							}));
						});
					}*/

					if(personnelIdEdit!=undefined && personnelIdEdit!=null)
					{
						$('#cooperative_id1').val(id);
						$.ajax({
							type: "GET",
							url: "/api/get-personnel-by-id/" + personnelIdEdit + "/" + id,
							data: [],
							processData: false,
							contentType: false,
							cache: false,
							timeout: 600000,
							success: function (data) {
								console.log(data);
								if(data.status==0)
								{
									$('#addPersonnelBtnDiv').hide();
									$('#viewpersonnelprofilediv').hide();
									if(id!=null)
									{
										document.getElementById('cooperative_id_hidden').value = id;
									}
									$('#createPersonnelLink').html("Update Profile");
									document.getElementById('actionTitle').innerHTML = '.: Add New Personnel';

									$( ".floater" ).hide();
									$( "#newpersonneldiv" ).show();

									$("#newCompany").show();
									$("#addbvn-modal-container").show();
									$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {
										$('#roletype1').val(data.personnel.role_code);
										$('#position1').val(data.personnel.position);
										$('#lastname1').val(data.personnel.user.last_name);
										$('#firstname1').val(data.personnel.user.first_name);
										$('#mobilenumber1').val(data.personnel.user.mobile_number.substr(data.personnel.user.country.split('###')[1].length));
										$('#countrycode1').val((data.personnel.user.country.split('###')[1]));
										$('#emailaddress1').val(data.personnel.user.email_address);
										$('#personnelId').val(data.personnel.id);
										$('#legendTitle').html("Update Personnel/Staff");

									}});
								}
								else
								{
									toastr.error(data.message);
								}
							},
							error: function (e) {
								toastr.error(data.message);
							}
						});

					}
					else
					{
						$('#legendTitle').html("New Personnel/Staff");
						$('#addPersonnelBtnDiv').show();
						$('#viewpersonnelprofilediv').hide();
						if(id!=null)
						{
							document.getElementById('cooperative_id_hidden').value = id;
						}
						$('#createPersonnelLink').html("Create Staff");
						document.getElementById('actionTitle').innerHTML = '.: Update Personnel';

						$( ".floater" ).hide();
						$( "#newpersonneldiv" ).show();

						$("#newCompany").show();
						$("#addbvn-modal-container").show();
						$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

						}});
					}
				}
			},
			error: function (e) {
				toastr.error(data.message);
			}
	});

}

function getRndInteger(min, max) {
    return Math.floor(Math.random() * (max - min + 1) ) + min;
}

function viewGroupInvitations(type)
{
	//$( "#newCompany" ).show('slow', 'swing');
    colorCodes = {};
    /*colorCodes['63d0e6'] = '000000';
    colorCodes['ffe926'] = '000000';
    colorCodes['dbbaff'] = '000000';
    colorCodes['000000'] = 'ffffff';
    colorCodes['fc8b21'] = 'ffffff';
    colorCodes['fc2121'] = 'ffffff';
    colorCodes['ff19ba'] = 'ffffff';*/
    colorCodes['0d9eff'] = 'ffffff';
    colorCodesKeys = Object.keys(colorCodes);
    console.log(colorCodes);
    console.log(colorCodesKeys);
    console.log(colorCodesKeys.length);

	$.ajax({
			type: "GET",
			url: "/api/get-group-invite-by-user-role-id/" + type,
			data: [],
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					var companyList = data.data;
                    if(type==0)
                    {
					    $('#invitationDiv').html("");
                    }
					document.getElementById('actionTitle').innerHTML = '.: My Group Invitations';
                    html = '';
                    if(companyList.length>0)
                    {
                        if(type==1)
                        {
                            html = html + '<fieldset style="border: 1px solid silver !important; padding: 20px 20px 20px; padding-left: 5px !important; padding-right: 5px !important;">';
		                        html = html + '<legend style="text-align: left !important; width: auto !important; margin-bottom: 0px !important; border-bottom: 0 !important; font-size: 16px !important; font-weight: bold !important;">All Groups</legend>';
		                        html = html + '<div class="relative col col-md-12 col-xs-12 col-lg-12 col-sm-12" id="invitationDiv" style="">';
                        }

                        $.each(companyList, function(key, value) {
                            /*console.log(key);
                            console.log(value);*/
                            var k1 = getRndInteger(0, colorCodesKeys.length);
                            k1 = 0;
                            var ind = colorCodesKeys[k1];
                            console.log(k1);
                            console.log(ind);
                            console.log(colorCodesKeys);
						    html = html + '<div class="relative col col-md-12 col-xs-12 col-lg-12 col-sm-12" style="padding-left: 0px !important; padding-right: 0px !important">';
				                html = html + '<div class="col col-md-5 col-sm-12 col-xs-12 col-lg-5" style="font-size: 16px; padding: 20px; padding-bottom: 25px; border-radius: 5px 5px 5px 5px; text-align: center; border: 1px solid #9c9c9c; background-color: #'+ind+'; color: #'+colorCodes[ind]+' !important; float: left !important">';
                                    html = html + value.companyName;
                                    if(type==0)
                                    {
                                        html = html + '<br><a onclick="handleAcceptGroupInvitation(\''+value.cooperativeCode+'\') " class="btn btn-sm btn-success">Accept Invitation</a>';
                                    }
                                    else if(type==1)
                                    {
                                        if(value.isOpen!=null && value.isOpen==1)
                                            html = html + '<br><a href="" class="btn btn-sm btn-success">Join Group</a>';
                                        else
                                            html = html + '<br><a class="btn btn-sm btn-info">Strictly by Invitation</a>';
                                    }
                                html = html + '</div>';
				                html = html + '<div class="col col-md-7 col-sm-12 col-xs-12 col-lg-7" style="padding-right: 0px !important; background-color: #fff; color: #000 !important; float: left !important; padding: 5px; ">';
                                    html = html + (value.aboutGroup!=undefined && value.aboutGroup!=null ? value.aboutGroup : '<br>');
                                    if(value.registrationFee!=undefined && value.registrationFee!=null)
                                        html = html + '<br><u>Registration Fee:</u> ZMW' + parseFloat(value.registrationFee).toFixed(2);
                                    else
                                        html = html + '<br><u>Registration Fee:</u> No Registration Fees';

                                    every = '';
                                    if(value.membershipIntervalType!=undefined && value.membershipIntervalType!=null && value.membershipIntervalType=='DAY')
                                        every = 'Paid Every ' + value.membershipInterval + ' Day(s)';
                                    else if(value.membershipIntervalType!=undefined && value.membershipIntervalType!=null && value.membershipIntervalType=='WEEK')
                                        every = 'Paid Every ' + value.membershipInterval + ' Week(s)';
                                    else if(value.membershipIntervalType!=undefined && value.membershipIntervalType!=null && value.membershipIntervalType=='MONTH')
                                        every = 'Paid Every ' + value.membershipInterval + ' Month(s)';
                                    else if(value.membershipIntervalType!=undefined && value.membershipIntervalType!=null && value.membershipIntervalType=='YEAR')
                                        every = 'Paid Every ' + value.membershipInterval + ' Year(s)';
                                    else if(value.membershipIntervalType!=undefined && value.membershipIntervalType!=null && value.membershipIntervalType=='ONCE')
                                        every = 'Paid Once';

                                    if(value.currentCooperativeDueId!=undefined && value.currentCooperativeDueId!=null && (value.membershipFees!=undefined && value.membershipFees!=null && value.membershipFees>-1))
                                        html = html + '<br><u>Membership Dues:</u> ZMW' + ((value.membershipFees!=undefined && value.membershipFees!=null && value.membershipFees>-1) ? parseFloat(value.membershipFees).toFixed(2) : 0.00) + ' - '+ every +'';
                                html = html + '</div>';
			                html = html + '</div>';

                            html = html + '<div class="col col-md-12 col-sm-12 col-xs-12 col-lg-12" style="padding: 5px; "><hr></div>';
					    });

                        if(type==1)
                        {
	                            html = html + '</div>';
	                        html = html + '</fieldset>';
                        }

                        if(type==1)
                        {
                            $('#otherGroups').html(html);
                        }
                        else if(type==0)
                        {
                            $('#invitationDiv').html(html);
                        }
                    }
                    else
                    {
                        if(type==1)
                        {
                            html = html + '<div class="relative col col-md-12 col-xs-12 col-lg-12 col-sm-12" style="padding-left: 0px !important; padding-right: 0px !important">';
                                html = html + 'You do not have any invitations to join any Village Banking Groups';
                            html = html + '</div>';
                            $('#invitationDiv').html(html);
                        }
                        else if(type==0)
                        {
                            html = html + '<div class="relative col col-md-12 col-xs-12 col-lg-12 col-sm-12" style="padding-left: 0px !important; padding-right: 0px !important">';
                                html = html + 'There are no Village Banking Groups you can join';
                            html = html + '</div>';
                            $('#invitationDiv').html(html);
                        }
                    }


				    $( ".floater" ).hide();

				    $("#groupinvitationsdiv").show();
				    $("#newCompany").show();
	                $("#addbvn-modal-container").show();
	                $("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	                }});
				}
			},
			error: function (e) {
				toastr.error(data.message);
			}
	});

}



function handleAcceptGroupInvitation(cooperativeCode)
{
    $.ajax({
			type: "GET",
			url: "/api/get-group-accept-invite/" + cooperativeCode,
			data: [],
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					$("#groupinvitationsdiv").show();
				    $("#newCompany").show();
				    handleClose();
				    toastr.success(data.message);
				}
			},
			error: function (e) {
				toastr.error(data.message);
			}
	});
}

function addExtraPersonnel(companiesSelectHTML, rolesListingHTML)
{
	var currentIndex = parseInt(document.getElementById('allPersonnelCount').value) + 1;
	var html='';
	html = html + '<div class="col col-md-12" id="adminentry1" style="padding-left: 0px !important; padding-right: 0px !important; background-color: #f7f8fa !important;">';
		html = html + '<label class="col col-md-12 text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="padding-right: 0px !important;" for="bvn">';
			html = html + '<div class="col col-md-4 pull-left" style="padding-left: 0px !important;">';
				html = html + '<span style="font-size: 14px !important; text-decoration: underline">Personnel #'+(currentIndex)+'</span><br>';
				html = html + '<input class="" checked style="margin-right: 0px !important; float: left !important" name="required[]" placeholder="" id="required1" type="checkbox" value="1">';
				html = html + '<span style="margin-right: 0px !important;" class="pull-left">&nbsp;&nbsp;Personnel Can Log In</span>';
			html = html + '</div>';

			//html = html + '<div class="col col-md-7 pull-right" style="padding-right: 0px !important; text-align: right !important">';
			//	html = html + '<a onclick="addExtraPersonnel(\"'+companiesSelectHTML+'\")" class="btn btn-primary pull-right" style="pointer: cursor !important;" type="submit">Add Personnel [+]</a>';
			//html = html + '</div>';
		html = html + '</label>';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<select class="textfieldclass col col-md-6 typeselect" onchange="handleUserRoleChange(this, '+currentIndex+')" style="margin-right: 0px !important; float: left !important" name="roletype[]" id="roletype1">';
			html = html + '<option value>--Select One--</option>';
			html = html + rolesListingHTML;
		html = html + '</select>';

		var newcoopid = 'cooperative_id' + currentIndex;
		console.log(newcoopid);
		console.log(companiesSelectHTML);
		var companiesSelectHTML_ = companiesSelectHTML.replace('cooperative_id1', newcoopid);
		companiesSelectHTML_ = companiesSelectHTML_.replace('cooperative_id1', newcoopid);
		console.log(companiesSelectHTML_);

		html = html + companiesSelectHTML_;
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<select class="textfieldclass col col-md-6 typeselect" onchange="handlePositionSelect('+currentIndex+')" style="margin-right: 0px !important; float: left !important" name="position[]" id="position'+currentIndex+'">';
			html = html + '<option value>--Position--</option>';
			//html = html + '<option value="CHAIRMAN">Chairman</option>';
			//html = html + '<option value="SECRETARY">Secretary</option>';
			//html = html + '<option value="TREASURER">Treasurer</option>';
			//html = html + '<option value="DIRECTOR">Director</option>';
			//html = html + '<option value="ADMIN">Administrator</option>';
		html = html + '</select>';
		html = html + '<input title="Provide first name of the personnel" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: right !important" name="firstname[]" placeholder="Enter First Name" id="firstname'+currentIndex+'" type="text" value="">';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<input title="Provide surname of the personnel" class="textfieldclass col col-md-6" style="margin-right: 0px !important; float: left !important" name="lastname[]" placeholder="Enter Last Name" id="lastname'+currentIndex+'" type="text" value="">';
		html = html + '<input title="Provide mobile number of the personnel" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: right !important" name="mobilenumber[]" placeholder="Enter Mobile No" id="mobilenumber'+currentIndex+'" type="text" value="">';
		html = html + '<select name="countrycode[]" class="textfieldclass col col-md-2 pull-right">';
			html = html + '<option value="260">+260</option>';
		html = html + '</select>';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<input title="Provide email address of the personnel" class="textfieldclass col col-md-6" style="margin-right: 0px !important; float: left !important" name="emailaddress[]" placeholder="Enter Email" id="emailaddress'+currentIndex+'" type="text" value="">';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
	html = html + '</div>';
	html = html + '<div style="clear: both !important; padding: 0px !important; height: 4px !important; font-size: 4px !important">&nbsp;</div>';
	document.getElementById('allPersonnelCount').value = currentIndex;
	var newelement = document.createElement('DIV');
	newelement.innerHTML = html;
	var allfields_ = document.getElementById('alladminfields');
	allfields_.appendChild(newelement);
}



function addNewField()
{
	var currentIndex = parseInt(document.getElementById('allBioFieldsCount').value) + 1;
	var html='';
	html = html + '<div class="col col-md-12" id="entry1" style="padding-left: 0px !important; padding-right: 0px !important; background-color: #f7f8fa !important;">';
		html = html + '<hr style="margin-top: 0px !important; margin-bottom: 20px !important; border: 0; border-top: 1px solid #000;">';
		html = html + '<label class="col col-md-12 text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="bvn">';
			html = html + '<div class="col col-md-3 pull-left" style="padding-left: 0px !important;">';
				html = html + 'Field #' + currentIndex;
			html = html + '</div>';
			//html = html + '<div class="col col-md-8 pull-right" style="padding-right: 0px !important; text-align: right !important">';
				//html = html + 'Compulsory&nbsp;&nbsp;';
				//html = html + '<input class="textfieldclass col" style="margin-right: 0px !important; float: right !important" name="required[]" placeholder="" id="required'+currentIndex+'" type="checkbox" value="'+currentIndex+'">';
			//html = html + '</div>';
			html = html + '<div class="col pull-right" style="padding-right: 0px !important; text-align: right !important">';
				html = html + '<input class="textfieldclass col" style="margin-right: 0px !important; float: right !important" name="required[]" placeholder="" id="required'+currentIndex+'" type="checkbox" value="'+(currentIndex)+'">';
					html = html + 'Compulsory&nbsp;&nbsp;';
			html = html + '</div>';
			html = html + '<div class="col pull-right" style="padding-right: 10px !important; text-align: right !important">';
				html = html + '<input class="textfieldclass col" style="margin-right: 0px !important; float: right !important" name="unique[]" placeholder="" id="unique'+currentIndex+'" type="checkbox" value="'+(currentIndex)+'">';
				html = html + 'Unique&nbsp;&nbsp;';
			html = html + '</div>';
		html = html + '</label>';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<select onchange="handleTypeSelect('+currentIndex+')" class="textfieldclass col col-md-5 typeselect" style="margin-right: 0px !important; float: left !important" name="fieldtype[]" id="fieldtype'+currentIndex+'">';
			html = html + '<option value>--Type of Field--</option>';
			html = html + '<option value="SELECT">Drop Down Options</option>';
			html = html + '<option value="TEXTFIELD">Single Line Text</option>';
			html = html + '<option value="NUMBERFIELD">Numbers</option>';
			html = html + '<option value="TELEPHONEFIELD">Telephones</option>';
			html = html + '<option value="EMAILFIELD">Emails</option>';
			html = html + '<option value="DATE">Dates</option>';
			html = html + '<option value="TEXTAREA">Multi-line Text</option>';
			html = html + '<option value="RADIO">Single Option</option>';
			html = html + '<option value="CHECKBOX">Multiple Option</option>';
		html = html + '</select>';
		html = html + '<input class="textfieldclass col col-md-6" style="margin-right: 0px !important; float: right !important" name="title[]" placeholder="Title of field" id="title'+currentIndex+'" type="text" value="">';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<input title="Seperate values using ### example MALE###FEMALE" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: left !important" name="options[]" placeholder="Possible Values" id="options'+currentIndex+'" type="text" value="">';
		//html = html + '<input title="Example 3/10 means minimum of 3 and maximum of 10. -/10 means maximum of 10 characters only. 10/- means minimum of 10 characters only" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: right !important" name="minmax[]" placeholder="Min/Max Length" id="minmax'+currentIndex+'" type="text" value="">';

		html = html + '<div class="col col-md-3 pull-right" style="padding-right: 0px !important">';
			html = html + '<input title="Example 10 means maximum of 10. Leave empty if not applicable" class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important" name="max[]" placeholder="Max Length" id="max'+currentIndex+'" type="text" value="">';
		html = html + '</div>';

		html = html + '<div class="col col-md-3 pull-right" style="padding-left: 0px !important">';
			html = html + '<input title="Example 3 means minimum of 3. Leave empty if not applicable" class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important" name="min[]" placeholder="Min Length" id="min'+currentIndex+'" type="text" value="">';
		html = html + '</div>';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
		html = html + '<input title="Provide a description of this field for users" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: left !important" name="placeholder[]" placeholder="Enter Description Of Field" id="placeholder'+currentIndex+'" type="text" value="">';
		html = html + '<select class="textfieldclass col col-md-6 fieldorderclass" style="margin-right: 0px !important; float: right !important" id="order'+currentIndex+'" name="order[]">';
			html = html + '<option value>--Field Order--</option>';
			for(count=(minOrder+1); count<maxOrder; count++)
			{
				html = html + '<option value="'+count+'">'+count+'</option>';
			}
		html = html + '</select>';
		html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
	html = html + '</div>';
	html = html + '<div style="clear: both !important; padding: 0px !important; height: 4px !important; font-size: 4px !important">&nbsp;</div>';
	document.getElementById('allBioFieldsCount').value = currentIndex;
	var newelement = document.createElement('DIV');
	newelement.innerHTML = html;
	var allfields_ = document.getElementById('allfields');
	allfields_.appendChild(newelement);
}


function handleTypeSelect(id)
{
	var fieldtype = '#fieldtype' + id;
	fieldtype = $(fieldtype).val();
	if(fieldtype=='SELECT' || fieldtype=='RADIO' || fieldtype=='CHECKBOX')
	{
		var optionskey = '#options'+id;
		var minmaxkey = '#min'+id;
		var minmaxkey1 = '#max'+id;
		$(optionskey).val("");
		$(optionskey).attr('readonly', false);
		$(minmaxkey).val("");
		$(minmaxkey).attr('readonly', true);
		$(minmaxkey1).val("");
		$(minmaxkey1).attr('readonly', true);
	}
	else if(fieldtype=='DATE')
	{
		var optionskey = '#options'+id;
		var minmaxkey = '#min'+id;
		var minmaxkey1 = '#max'+id;
		$(optionskey).val("");
		$(optionskey).attr('readonly', true);
		$(minmaxkey).val("");
		$(minmaxkey).attr('readonly', true);
		$(minmaxkey1).val("");
		$(minmaxkey1).attr('readonly', true);
	}
	else if(fieldtype=='TEXTFIELD' || fieldtype=='NUMBERFIELD' || fieldtype=='TELEPHONEFIELD' || fieldtype=='EMAILFIELD' || fieldtype=='TEXTAREA')
	{
		var optionskey = '#options'+id;
		var minmaxkey = '#min'+id;
		var minmaxkey1 = '#max'+id;
		$(optionskey).val("");
		$(optionskey).attr('readonly', true);
		$(minmaxkey).val("");
		$(minmaxkey).attr('readonly', false);
		$(minmaxkey1).val("");
		$(minmaxkey1).attr('readonly', false);
	}
}


function showPaymentOption(formelementsdata, membershipregfee, callBackFunct, retVariables)
{
	const options1 = { style: 'currency', currency: 'ZMW' };
	var html = '';
	if(membershipregfee!=undefined && membershipregfee!=null && membershipregfee.length>0)
	{
		html = html + '<table class="table table-hover col col-md-12">';
			html = html + '<thead>';
				html = html + '<tr>';
					html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
					html = html + '<th style="background-color: #000 !important; color: #fff !important;">Item To Pay</th>';
					html = html + '<th style="background-color: #000 !important; color: #fff !important;text-align: right">Amount(ZMW)</th>';
				html = html + '</tr>';
			html = html + '</thead>';
			html = html + '<tbody>';
			var total = 0;
			for(var i1=0; i1<membershipregfee.length; i1++)
			{
				html = html + '<tr>';
					html = html + '<td style="text-align: center !important; text-align: left !important;">'+ (i1+1) +'.</td>';
					html = html + '<td style="text-align: center !important; text-align: left !important;">'+ (membershipregfee[i1]['title']) +'</td>';
					html = html + '<td style="text-align: center !important; text-align: right !important;">'+ (membershipregfee[i1]['amount']) +'</td>';
				html = html + '</tr>';
				total = total + membershipregfee[i1]['amount'];
			}
			html = html + '<tr>';
				html = html + '<td style="background-color: #000 !important; color: #fff !important; text-align: left !important;" colspan="2">Total</td>';
				html = html + '<td style="background-color: #000 !important; color: #fff !important; text-align: right !important;">'+ (total) +'</td>';
			html = html + '</tr>';
			html = html + '</tbody>';
		html = html + '</table>';
		console.log(html);
		var totalFormatted = Number.parseFloat(total);
		const numberFormat1 = new Intl.NumberFormat('en-US', options1);
		totalFormatted = numberFormat1.format(totalFormatted);
		$('#totalToPay').html('Pay<br>' + totalFormatted);
		$('#itemsToBePaidListDiv').html(html);
	}
	$('#formelementsdata').val(formelementsdata);
	//$('#paymentDiv').hide();
	document.getElementById('actionTitle').innerHTML = '.: Payment Options';

	$( ".floater" ).hide();
	$( "#paymentDiv" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});





	if(total==0)
	{
		$('#cardpaymentbutton').html('<a class="btn btn-success col col-md-12" style="cursor: pointer !important" onclick="payNow()">Yes, Proceed To Register Member</a>');
		$('#cashpaymentbutton').html('<a class="btn btn-success col col-md-12" style="cursor: pointer !important" onclick="createNewMember()">Yes, Proceed To Register Member</a>');
		returnfxn = callBackFunct;
		returnVariables = retVariables;
	}
	else
	{
		var total = Number.parseFloat(total);
		const numberFormat1 = new Intl.NumberFormat('en-US', options1);
		total = numberFormat1.format(total);
		$('#cardpaymentbutton').html('<a class="btn btn-success col col-md-12" style="cursor: pointer !important" onclick="payNow()">Yes, Proceed To Pay The Sum of ' + (total) + '</a>');
		$('#cashpaymentbutton').html('<a class="btn btn-success col col-md-12" style="cursor: pointer !important" onclick="createNewMember()">Yes, Proceed. I Have Collected The Sum of '+ (total) +'</a>');
		returnfxn = callBackFunct;
		returnVariables = retVariables;
	}
}

function goBackFromPayment()
{
	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});

	console.log(returnVariables);
	//var args = Array.prototype.slice.call(returnVariables, 1);
	//console.log(args);
	returnfxn.apply(this, returnVariables);
}


function handlePayOptions(ele)
{
	$('#cashpaymentbutton').hide();
	$('#cardpaymentbutton').hide();
	if(ele.checked===true && ele.value==1)
	{
		$('#cashpaymentbutton').show();
	}
	else if(ele.checked===true && ele.value==0)
	{
		$('#cardpaymentbutton').show();
	}
}





function addNewMember(id, companyName, userRoleId)
{
	if(userRoleId!=undefined && userRoleId!=null)
	{
		$.ajax({
			type: "GET",
			url: "/api/get-customer-form-bio-data/" + userRoleId,
			data: [],
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					$('#proceedToPayBtnDiv').show();
					$('#proceedToPayBtn').html("Update Members Profile");
					console.log(id);
					$('#addCustomerDiv2').hide();
					document.getElementById('actionTitle').innerHTML = '.: Update Profile';
					$('#new_customer_cooperative').val(id);

					$('#firstName').val(data.userprofile.firstName);
					$('#lastName').val(data.userprofile.lastName);
					$('#emailaddress').val(data.userprofile.emailAddress);
					$('#memberCountryCode').val(data.userprofile.phonePrefix);
					$('#phonenumber').val(data.userprofile.phoneNumber.substr(data.userprofile.phonePrefix.split('###')[1].length));
					$('#identificationNumber').val(data.userprofile.identificationNumber);
					$('#identificationType').val(data.userprofile.identificationType);
					$('#editcustomerid').val(data.userprofile.userRoleId);
					handleSelector(id, data.list!=undefined && data.list!=null ? data.list : null);


					$( ".floater" ).hide();
					$( "#newcustomerdiv" ).show();

					$("#newCompany").show();
					$("#addbvn-modal-container").show();
					$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {
						console.log('===> id' + id);
					}});
				}
				else
				{
					toastr.error(data.message);
				}
			},
			error: function (e) {
				toastr.error(data.message);
			}
		});
	}
	else
	{
		console.log(id);
		$('#addCustomerDiv2').hide();
		document.getElementById('actionTitle').innerHTML = '.: Add New Member';
		$('#new_customer_cooperative').val(id);
		handleSelector(id);

		$( ".floater" ).hide();
		$( "#newcustomerdiv" ).show();

		$("#newCompany").show();
		$("#addbvn-modal-container").show();
		$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {
			console.log('===> id' + id);
		}});
	}
}


function validateForm(reqdelements)
{
	$('.errorFound').removeClass('errorFound');
	var allAreFilled = true;
	var allReqd = reqdelements.split('###');
	console.log(allReqd);
	var counter = 0;
	var totalCounter = 0;
	var focusElement;
	//allReqd.forEach(function(k) {
	while(allAreFilled===true && totalCounter<allReqd.length)
	{
		k = allReqd[totalCounter];
		console.log('---');
		console.log(k);
		var i = document.getElementById(k);
		console.log(i);
		//if (!allAreFilled){return ;}
		if (!i.value){
			allAreFilled = false;
		}
		if (i.type === "radio") {
			var radios = document.getElementsByName(i.id);
			var allAreFilled_ = false;
			radios.forEach(function(cb) {
				if(cb.checked)
				{
					allAreFilled_ = true;
				}
			});
			if(allAreFilled_==false)
			{
				if(counter==0)
					focusElement = i;
				counter++;
			}
			allAreFilled = allAreFilled_;
		}
		if (i.type === "checkbox") {
			var checkboxes = document.getElementsByName(i.id);
			var allAreFilled_ = false;
			checkboxes.forEach(function(cb) {
				if(cb.checked)
				{
					allAreFilled_ = true;
				}
			});
			if(allAreFilled_==false)
			{
				if(counter==0)
					focusElement = i;
				counter++;
			}
			allAreFilled = allAreFilled_;
		}
		if (i.type === "text" || i.type === "tel" || i.type === "number" || i.tagName.toLowerCase() === "textarea") {
			allAreFilled = i.value && i.value.length>0 ? true : false;
			if(allAreFilled==false)
			{
				if(counter==0)
					focusElement = i;
				counter++;
			}
		}
		if (i.tagName.toLowerCase() === "select") {
			allAreFilled = i.value && i.value!= -1 ? true : false;
			if(allAreFilled==false)
			{
				if(counter==0)
					focusElement = i;
				counter++;
			}
		}
		totalCounter++;
	}
	return [allAreFilled, focusElement];
}





function proceedToRegisterMemberStepTwo()
{
	if($('#editcustomerid').val().length>0)
	{
		createNewMember();
	}
	else
	{
		new_customer_cooperative = $('#new_customer_cooperative').val();
		var url = '/api/get-fees-by-cooperative-id/' + new_customer_cooperative;
		$.ajax({
			type: "GET",
			url: url,
			data: [],
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					var itemsToPay = data.payment_items;
					proceedToPay(itemsToPay);
				}
				else
				{
					//toastr.error(data.message);
				}
			},
			error: function (e) {
				toastr.error(e);
			}
		});
	}
}


function proceedToPay(itemsToPay)
{
	console.log(itemsToPay);
	var reqdelements = $("#reqdelements").val();
	var validateResp = validateForm(reqdelements);
	var allAreFilled = validateResp[0];
	var focusElement = validateResp[1];
	console.log(allAreFilled);
	if (!allAreFilled) {
		if(focusElement!=undefined)
		{
			focusElement.focus();
			$(('#' + focusElement.id)).addClass('errorFound');
		}
		toastr.error('You need to fill out all required fields');
	}
	else
	{
		var form = $('#newcustomerdiv')[0];
		var data = new FormData(form);
		var addData = [];
		data.forEach((value, key) => {addData[key] = value});
		var json = JSON.stringify(addData);
		//$('#formelementsdata').val(json);
		var retVariables = [];
		retVariables.push($('#new_customer_cooperative').val());
		var membershipregfee = 0.00;
		if( $('#membershipregfee').length )
			membershipregfee = $('#membershipregfee').val();

		//alert(membershipregfee);
		handleClose(1);
		setTimeout(
			function()
			{
				showPaymentOption(json, itemsToPay, addNewMember, [$('#new_customer_cooperative').val()]);
			}
		, 1000);


	}
}

function proceedToPaymentPage()
{
	$('#paymentDiv').attr('action', '/payments/proceed-to-payment-page').submit();
}

function createNewMember()
{
	var form = $('#newcustomerdiv')[0];
	var data = new FormData(form);
	//console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/create-new-member",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				//key = '#coop_member_count_' + data.cooperative_id;
				//$( key ).html(data.member_count);
				$( "#newcompanydiv" ).hide();
				$( "#startprojectdiv" ).hide();
				$( "#newcustomerdiv" ).hide();
				handleClose();
				toastr.success(data.message);
			}
			else
			{
				if(data.failed!=undefined)
				{
					var keys = Object.keys(data.failed);
					console.log(keys);
					var t2=0;
					for(var t1=0; t1<keys.length; t1++)
					{
						var id_ = '#'+keys[t1];
						console.log(id_);
						$(id_).addClass('errorFound');
						if(t2==0)
						{
							$(id_).focus();
						}
						t2++;
					}
				}
				toastr.error(data.message);
				$( ".floater" ).hide();
				$( "#newcustomerdiv" ).show();
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}

function handleSelector(selectedVal, biodataSaved)
{
	console.log(biodataSaved);
	$('#proceedToPayBtnDiv').hide();
	var url = "/api/get-form-bio-data/" + selectedVal;
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$('#addCustomerDiv2').show();
				if(data.membership_reg_fee!=undefined && data.membership_reg_fee['SINGLE']!=undefined)
				{
					console.log(0);
					if( $('#membershipregfee').length )
					{
						console.log(1);
						$('#membershipregfee').val(data.membership_reg_fee['SINGLE']);
						$('#proceedToPayBtnDivRegister').html('Next');
					}
					else
					{
						console.log(2);
						$('#membershipregfee').append('<input name="membershipregfee" id="membershipregfee" value="'+(data.membership_reg_fee['SINGLE'])+'" type="hidden">');
						$('#proceedToPayBtnDivRegister').html('Next');
					}
				}
				else
				{
					console.log(3);
					$('#membershipregfee').remove();
					$('#proceedToPayBtnDivRegister').html('Register Member');
				}
				console.log(4);
				var reqdelementsFound = "";
				var otherDetails = data.list;
				console.log(otherDetails);
				var html = '';

				var dateFields = [];
				if(otherDetails.length>0)
				{
					html = '<div style="padding: 10px !important; height: 10px !important;">&nbsp;</div>';
					html = html + '<fieldset style="border: 1px solid silver !important; padding: 20px 20px 20px">';
						html = html + '<legend style="width: auto !important; margin-bottom: 0px !important; border-bottom: 0 !important; font-size: 16px !important; font-weight: bold !important;">Other Details</legend>';
						//html = html + '<p style="font-size: 15px !important; color: #000 !important; font-weight: bold; text-decoration: underline">Other Details</p>';
						html = html + '<div id="addCustomerDiv22" style="display: block !important;">';
							//html = html + '<p style="font-size: 15px !important; color: #000 !important">Other Details</p>';

							console.log((otherDetails).length);
							for(var v=0; v<(otherDetails).length; v++)
							{
								var otherDetail = otherDetails[v];
								console.log((otherDetail));
								var pattern = "";
								if(otherDetail.minLength!=undefined && otherDetail.maxLength!=undefined)
								{
									pattern = ' pattern=".{' + otherDetail.minLength + ',' + otherDetail.maxLength + '}"';
								}
								else if(otherDetail.minLength!=undefined)
								{
									pattern = ' pattern=".{' + otherDetail.minLength + ',}"';
								}
								else if(otherDetail.maxLength!=undefined)
								{
									pattern = ' pattern=".{,' + otherDetail.maxLength + '}"';
								}

								if(otherDetail.required_yes==1)
									reqdelementsFound = '###' + reqdelementsFound;

								var biodataSaved_ = [];
								if(biodataSaved!=undefined && biodataSaved!=null)
								{
									for(var k1=0; k1<biodataSaved.length; k1++)
									{
										biodataSaved_[biodataSaved[k1].name] = biodataSaved[k1].value;
									}
								}
								console.log(biodataSaved_);

								if(otherDetail.fieldType=='SELECT')
								{
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="' + (otherDetail.name.toLowerCase()) + '">' + otherDetail.title.toLowerCase() + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<select class="textfieldclass" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' id="'+ otherDetail.name.toLowerCase() + '" name="'+ otherDetail.name.toLowerCase() + '">';
											if(otherDetail.placeholder!=undefined)
											{
												html = html + '<option value="-1">--' + ((otherDetail.placeholder!=undefined) && otherDetail.placeholder.length >0 ? otherDetail.placeholder : '') + '--</option>';
											}

											if(otherDetail.options!=undefined)
											{
												var listOfOptions = otherDetail.options.split('###');
												for(var v1=0; v1<(listOfOptions).length; v1++)
												{
													var option_ = listOfOptions[v1];
													html = html + '<option value="' + option_ + '" '+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null && biodataSaved_[otherDetail.name.toLowerCase()]==option_ ? 'selected' : '' )+'>' + option_ + '</option>';
												}
											}
										html = html + '</select>';
									html = html + '</div>';
								}

								if(otherDetail.fieldType=='TEXTFIELD')
								{
									console.log(otherDetail.required_yes);
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<input '+pattern+' class="textfieldclass" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' name="'+ otherDetail.name.toLowerCase() + '" id="'+ otherDetail.name.toLowerCase() + '" placeholder="' + (otherDetail.placeholder!=undefined ? otherDetail.placeholder : '') + '" type="text" value="'+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null ? biodataSaved_[otherDetail.name.toLowerCase()] : '' )+'">';
									html = html + '</div>';
								}

								if(otherDetail.fieldType=='NUMBERFIELD')
								{
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<input class="textfieldclass" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' name="'+ otherDetail.name.toLowerCase() + '" id="'+ otherDetail.name.toLowerCase() + '" placeholder="' + (otherDetail.placeholder!=undefined ? otherDetail.placeholder : '') + '" type="number" value="'+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null ? biodataSaved_[otherDetail.name.toLowerCase()] : '' )+'">';
									html = html + '</div>';
								}

								if(otherDetail.fieldType=='TELEPHONEFIELD')
								{
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<input ' + pattern + ' class="textfieldclass" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' name="'+ otherDetail.name.toLowerCase() + '" id="'+ otherDetail.name.toLowerCase() + '" placeholder="' + (otherDetail.placeholder!=undefined ? otherDetail.placeholder : '') + '" type="tel" value="'+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null ? biodataSaved_[otherDetail.name.toLowerCase()] : '' )+'">';
									html = html + '</div>';
								}

								if(otherDetail.fieldType=='EMAILFIELD')
								{
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<input class="textfieldclass" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' name="'+ otherDetail.name.toLowerCase() + '" id="'+ otherDetail.name.toLowerCase() + '" placeholder="' + (otherDetail.placeholder!=undefined ? otherDetail.placeholder : '') + '" type="email" value="'+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null ? biodataSaved_[otherDetail.name.toLowerCase()] : '' )+'">';
									html = html + '</div>';
								}

								if(otherDetail.fieldType=='DATE')
								{
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '12</label>';
										html = html + '<input class="textfieldclass" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' name="'+ otherDetail.name.toLowerCase() + '" id="'+ otherDetail.name.toLowerCase() + '" placeholder="' + (otherDetail.placeholder!=undefined ? otherDetail.placeholder : '') + '" type="text" value="'+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null ? biodataSaved_[otherDetail.name.toLowerCase()] : '' )+'">';
									html = html + '</div>';
									dateFields.push(otherDetail.name.toLowerCase());
								}

								if(otherDetail.fieldType=='TEXTAREA')
								{
									html = html + '<div class="flex flex-col mb-8 relative">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<textarea ' + pattern + ' class="textfieldclass col col-md-12" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' name="'+ otherDetail.name.toLowerCase() + '" id="'+ otherDetail.name.toLowerCase() + '" placeholder="' + (otherDetail.placeholder!=undefined ? otherDetail.placeholder : '') + '">'+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null ? biodataSaved_[otherDetail.name.toLowerCase()] : '' )+'</textarea>';
									html = html + '</div>';
								}

								if(otherDetail.fieldType=='RADIO')
								{
									html = html + '<div class="col col-md-12 mb-8 relative" style="padding-left: 0px;">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
										if(otherDetail.options!=undefined)
										{
											var listOfOptions = otherDetail.options.split('###');
											for(var v1=0; v1<(listOfOptions).length; v1++)
											{
												var option_ = listOfOptions[v1];
												html = html + '<div class="col col-md-6 style="float: left !important">';
												html = html + '<input class="textfieldclass" name="'+ otherDetail.name.toLowerCase() + '" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' id="'+ otherDetail.name.toLowerCase() + '" type="radio" value="' + option_ + '" '+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null && biodataSaved_[otherDetail.name.toLowerCase()]==option_ ? 'checked' : '' )+'>&nbsp;&nbsp;' + option_;
												html = html + '</div>';
											}
										}
									html = html + '</div>';
									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
								}

								if(otherDetail.fieldType=='CHECKBOX')
								{
									html = html + '<div class="col col-md-12 mb-8 relative" style="padding-left: 0px;">';
										html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="'+ otherDetail.name.toLowerCase() + '">' + otherDetail.title + (otherDetail.requiredYes!=undefined && otherDetail.requiredYes==1 ? '<span style="color: red; font-weight: bold"> *</span>' : '') + '</label>';
										html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
										if(otherDetail.options!=undefined)
										{
											var listOfOptions = otherDetail.options.split('###');
											for(var v1=0; v1<(listOfOptions).length; v1++)
											{
												var option_ = listOfOptions[v1];
												html = html + '<div class="col col-md-6 style="float: left !important">';
												html = html + '<input class="textfieldclass" name="'+ otherDetail.name.toLowerCase() + '" ' + (otherDetail.required_yes!=undefined && otherDetail.required_yes==1 ? 'required' : '') + ' id="'+ otherDetail.name.toLowerCase() + '" type="checkbox" value="'+option_+'" '+(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_[otherDetail.name.toLowerCase()]!=undefined && biodataSaved_[otherDetail.name.toLowerCase()]!=null && biodataSaved_[otherDetail.name.toLowerCase()]==option_ ? 'checked' : '' )+'>&nbsp;&nbsp;'+option_;
												html = html + '</div>';
											}
										}
									html = html + '</div>';
									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
								}

							}
							//html = html + '<div class="flex flex-1 items-end">';
								//html = html + '<a class="btn btn-success col col-md-12" onclick="handleSubmitCustomerFormStepTwo()">Submit</a>';
							//html = html + '</div>';
						html = html + '</div>';
					html = html + '</fieldset>';
				}
				console.log(html);
				var newelement = document.getElementById('addCustomerDiv2');
				newelement.innerHTML = html;

				for(var y1=0; y1<dateFields.length; y1++)
				{
					var y2 = '#'+dateFields[y1];
					$( function() {
						var today = new Date();
						$(y2).datepicker({
							dateFormat: 'yy-mm-dd',
						});
					} );
				}
				var reqdelements = $('#reqdelements').val();
				reqdelements = reqdelements + reqdelementsFound;
				console.log(reqdelements);
				$('#reqdelements').val(reqdelements);
				$('#proceedToPayBtnDiv').show();
				$('#proceedToPayBtn').html("Register Member");

				if(biodataSaved_!=undefined && biodataSaved_!=null && biodataSaved_.length>0)
				{
					var hm = '<a class="btn btn-primary col col-md-12" style="cursor: pointer !important" id="proceedToPayBtn" onclick="proceedToRegisterMemberStepTwo()">Save Profile</a>';
					$('#proceedToPayBtnDiv').html(hm);
				}
				else
				{
					var hm = '<a class="btn btn-success col col-md-12" style="cursor: pointer !important" id="proceedToPayBtn" onclick="proceedToRegisterMemberStepTwo()">Register Member</a>';
					$('#proceedToPayBtnDiv').html(hm);
				}


			}
			else
			{
				//toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});

}


function loadDuesListingView(cooperative_id, title, type, userId)
{
	$('.floater').hide();
	$('#membershipdueslisting').show();
	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
	var html = '';
	html = html + '<table class="table table-hover col col-md-12">';
		html = html + '<thead>';
			html = html + '<tr>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Due Date</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Status</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;text-align: right">Outstanding Amount</th>';
			html = html + '</tr>';
		html = html + '</thead>';
		html = html + '<tbody>';
			html = html + '<tr>';
				html = html + '<td colspan="5" style="text-align: center !important;">There are currently No Unpaid Membership Dues</td>';
			html = html + '</tr>';
		html = html + '</tbody>';
	html = html + '</table>';
	$('#dues-listing-div').html(html==undefined ? '' : html);

	document.getElementById('actionTitle').innerHTML = title;
	var url = "/api/dues-listing/" + cooperative_id;
	if(userId!=undefined && userId!=null)
		url = url + '/' + userId

	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {

			var isCoopAdmin = data.isCoopAdmin;
			console.log(isCoopAdmin);
			if(data.status==0)
			{
				var duesList = data.duesList;
				$('#addCustomerDiv2').show();

				html = '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Due Date</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Status</th>';
							if(type==0)
							{
								html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important">Amount Paid</th>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important">Balance</th>';
							}
							if(type==1)
							{
								html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important">Outstanding Amount</th>';
							}
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
					console.log(duesList);
					var total = 0;
					var totalBalance = 0;
					var counter = 0;
					var paidIndex = 1;
					for(var v=0; v<(duesList).length; v++)
					{
						var due = duesList[v];
						console.log(due);
						if(type==1 && due.status=='OUTSTANDING')
						{
							counter++;
							html = html + '<tr>';
							if(isCoopAdmin==true)
							{
								html = html + '<td><input type="checkbox" name="due[]" value="' + due.id + '"></td>';
							}
							else
							{
								html = html + '<td>' + paidIndex++ + '</td>';
							}
								html = html + '<td>' + due.createdAt + '</td>';
								html = html + '<td>' + due.firstName + ' ' + due.lastName + ' - #' + due.id_pad + '</td>';
								html = html + '<td>' + due.status + '</td>';
								html = html + '<td style="text-align: right !important;">' + parseFloat(((due.dueAmount + due.penaltyIncurred) - due.amountPaid)) + '</td>';
							html = html + '</tr>';
							total = total + ((due.dueAmount + due.penaltyIncurred) - due.amountPaid);
						}
						if(type==0 && (due.status=='PAID' || due.status=='PARTIALLY PAID'))
						{
							counter++;
							html = html + '<tr>';
								html = html + '<td>' + paidIndex++ + '</td>';
								html = html + '<td>' + due.createdAt + '</td>';
								html = html + '<td>' + due.firstName + ' ' + due.lastName + ' - #' + due.id_pad + '</td>';
								html = html + '<td>' + due.status + '</td>';
								html = html + '<td style="text-align: right !important">' + parseFloat(due.amountPaid) + '</td>';
								html = html + '<td style="text-align: right !important;">' + parseFloat(((due.dueAmount + due.penaltyIncurred) - due.amountPaid)) + '</td>';
							html = html + '</tr>';
							total = total + (due.amountPaid);
							totalBalance = totalBalance + ((due.dueAmount + due.penaltyIncurred) - due.amountPaid);
						}
					}
					if(counter>0)
					{
						html = html + '<tr>';
							html = html + '<td style="background-color: #000 !important; color: #fff !important;">Total</td>';
							if(type==0)
							{
								html = html + '<td colspan="4" style="background-color: #000 !important; color: #fff !important; text-align: right !important;">' + parseFloat(total) + '</td>';
								html = html + '<td colspan="1" style="background-color: #000 !important; color: #fff !important; text-align: right !important;">' + parseFloat(totalBalance) + '</td>';
							}
							else if(type==1)
								html = html + '<td colspan="4" style="background-color: #000 !important; color: #fff !important; text-align: right !important;">' + parseFloat(total) + '</td>';

						html = html + '</tr>';
					}
					else
					{
						html = html + '<tr>';
							if(type==0)
								html = html + '<td colspan="6" style="text-align: center !important;">There are currently No Unpaid Membership Dues</td>';
							else if(type==1)
								html = html + '<td colspan="5" style="text-align: center !important;">There are currently No Unpaid Membership Dues</td>';

						html = html + '</tr>';
					}
					html = html + '</tbody>';
				html = html + '</table>';
				if(counter>0)
				{
					if(isCoopAdmin==true)
					{
						html = html + '<div class="col col-md-12">';
							html = html + '<a class="btn btn-success" style="cursor: pointer !important" onclick="payDuesByCash()">Pay By Cash</a>';
						html = html + '</div>';
					}
				}
				$('#dues-listing-div').html(html);
			}
			else
			{
				//toastr.error(data.message);
				var html = '';
				html = html + '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Due Date</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Status</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: center">Outstanding Amount</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
						html = html + '<tr>';
							html = html + '<td colspan="5" style="text-align: center">There are currently No Unpaid Membership Dues</td>';
						html = html + '</tr>';
					html = html + '</tbody>';
				html = html + '</table>';
				$('#dues-listing-div').html(html);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});

}



function viewPersonnel(id, coopId, editButton, verifyButton)
{
	$.ajax({
		type: "GET",
		url: "/api/get-personnel-by-id/" + id + "/" + coopId,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				document.getElementById('actionTitle').innerHTML = 'View Personnel Profile';

				$( ".floater" ).show();
				$( "#viewpersonnelprofilediv" ).show();
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});


				var html = "";
					html = html + '<p style="font-size: 15px !important; color: #000 !important; font-weight: bold; text-decoration: underline">Primary Details</p>';
					html = html + '<div class="mb-8 relative">';
						html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Full Name</label>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
						html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: left !important">' + data.personnel.user.first_name + ' ' + data.personnel.user.last_name + '</div>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.personnel.user.mobile_number!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Mobile Number</label>';
						if(data.personnel.user.mobile_number!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: left !important">' + data.personnel.user.mobile_number + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.personnel.user.email_address!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Email Address</label>';
						if(data.personnel.user.email_address!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.personnel.user.email_address + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.personnel.role_code!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Role</label>';
						if(data.personnel.role_code!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.personnel.role_code + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.personnel.position!=undefined && data.personnel.position!=null)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Position</label>';
						if(data.personnel.position!=undefined && data.personnel.position!=null)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.personnel.position + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.status!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Status</label>';
						if(data.status!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.personnel.status + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';

					if(verifyButton!=undefined && verifyButton==true)
					{
						if(data.personnel.status=='Inactive')
						{
							html = html + '<div style="clear:both !important; padding-left: 0px !important" class="col col-md-5" id="verifyProfileDiv">';
								html = html + '<a class="btn btn-success col col-md-12" style="cursor: pointer !important" onclick="activatePersonnel('+ id +')">Activate Personnel</a>';
							html = html + '</div>';
						}
						else if(data.personnel.status=='Active')
						{
							html = html + '<div style="clear:both !important; padding-left: 0px !important" class="col col-md-5" id="deactivateProfileDiv">';
								html = html + '<a class="btn btn-danger col col-md-12" style="cursor: pointer !important" onclick="deactivatePersonnel('+ id +')">Deactivate Personnel</a>';
							html = html + '</div>';
						}
					}
					if(editButton!=undefined && editButton==true)
					{
						html = html + '<div style="padding-right: 0px !important" class="col col-md-5 pull-right" id="editProfileDiv">';
							html = html + '<a class="btn btn-primary col col-md-12" style="cursor: pointer !important" onclick="editPersonnel('+ id +', '+ data.personnel.cooperative_id +')">Edit Profile</a>';
						html = html + '</div>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					}
				//html = html + '</div>';
				console.log(html);
				var newelement = document.getElementById('viewPersonnelDiv2');
				newelement.innerHTML = html;
				$('.floater').hide();
				$('#viewPersonnelDiv2').show();
			}
			else
			{
				//toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function editPersonnel(id, coopId)
{
	handleClose(1);
	setTimeout(
		function()
		{
			addNewPersonnel(coopId, '', id);
		}
	, 1000);

}

function loadDuesPaidListingView(cooperative_id, title, type, userId)
{
	$('.floater').hide();
	$('#membershipdueslisting').show();
	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
	var html = html + '<table class="table table-hover col col-md-12">';
		html = html + '<thead>';
			html = html + '<tr>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Due Date</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Status</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;text-align: right">Outstanding Amount</th>';
			html = html + '</tr>';
		html = html + '</thead>';
		html = html + '<tbody>';
			html = html + '<tr>';
				html = html + '<td colspan="5" style="text-align: center !important;">There are currently No Unpaid Membership Dues</td>';
			html = html + '</tr>';
		html = html + '</tbody>';
	html = html + '</table>';
	$('#dues-listing-div').html(html==undefined ? '' : html);

	document.getElementById('actionTitle').innerHTML = title;
	var url = "/api/dues-payments-listing/" + cooperative_id;
	if(userId!=undefined && userId!=null)
	{
		url = url + '/' + userId;
	}
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var duesList = data.duesList;
				$('#addCustomerDiv2').show();
				var html = '';
				html = '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;"><input type="checkbox" class="selectall" onchange="javascript:handleSelectAll()" id="selectall" value="1"></th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Date Paid</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Status</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important">Amount Paid</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
					console.log(duesList);
					var total = 0;
					var counter = 0;
					var counter1 = 0;
					var paidIndex = 1;
					for(var v=0; v<(duesList).length; v++)
					{
						var due = duesList[v];
						console.log(due);
						counter++;


						html = html + '<tr>';
						if(due.transferredYes==1)
						{
							html = html + '<td>T</td>';
						}
						else
						{
							counter1++;
							if(counter1>0 && data.parent_cooperative!=undefined && data.parent_cooperative!=null)
								html = html + '<td><input type="checkbox" class="checker" name="due[]" value="' + due.id + '"></td>';
							else
								html = html + '<td>'+(v+1)+'.</td>';
						}

							html = html + '<td>' + due.createdAt + '</td>';
							html = html + '<td>' + due.firstName + ' ' + due.lastName + ' - #' + due.id_pad + '</td>';
							if(due.transferredYes==1)
								html = html + '<td>Transferred</td>';
							else
								html = html + '<td>' + due.status + '</td>';

							html = html + '<td style="text-align: right !important;">' + parseFloat(due.amountPaid) + '</td>';
						html = html + '</tr>';
						if(due.transferredYes!=1)
							total = total + (due.amountPaid);
					}
					if(counter>0)
					{
						html = html + '<tr>';
							html = html + '<td style="background-color: #000 !important; color: #fff !important;">Total</td>';
							html = html + '<td colspan="4" style="background-color: #000 !important; color: #fff !important; text-align: right !important;">' + parseFloat(total) + '</td>';
						html = html + '</tr>';
					}
					else
					{
						html = html + '<tr>';
							html = html + '<td colspan="5" style="text-align: center !important;">There are currently No Paid Membership Dues</td>';
						html = html + '</tr>';
					}
					html = html + '</tbody>';
				html = html + '</table>';
				if(counter1>0 && data.parent_cooperative!=undefined && data.parent_cooperative!=null)
				{
					html = html + '<div class="col col-md-12">';
						html = html + '<a class="btn btn-success" style="cursor: pointer !important" onclick="transferDuesToParentCooperative()">Transfer Dues To Parent Cooperative Account</a>';
					html = html + '</div>';
				}
				$('#dues-listing-div').html(html);
			}
			else
			{
				//toastr.error(data.message);
				var html = '';
				html = html + '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Due Date</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Status</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: center">Outstanding Amount</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
						html = html + '<tr>';
							html = html + '<td colspan="5" style="text-align: center">There are currently No Unpaid Membership Dues</td>';
						html = html + '</tr>';
					html = html + '</tbody>';
				html = html + '</table>';
				$('#dues-listing-div').html(html);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});

}


function validateMemberUploadTemplate()
{
	var form = $('#bulkuploadmemberdiv')[0];
	var data = new FormData(form);
	/*$('.floater').hide();
	$('#membershipdueslisting').show();*/
    $('#validatedList').html('');
    html = '';
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/validate-upload-bulk-members-to-cooperative",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
                console.log(JSON.stringify(data.uploadedUsersCodes));
				toastr.info(data.message);
				console.log(223);
				var errorList = data.errorList;
				console.log(224);
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					console.log(225);
					$('#downloadErrorList').hide();
					console.log(226);
					handleClose();
				}
				var bulkuploadmembertocooperativeId = $('#bulkuploadmembertocooperative').val();
				$('#validatedbulkuploadmemberdiv').show();
                $('#bulkuploadmemberdiv').hide();

                html = html + '<table class="table table-hover col col-md-12 col-sm-12 col-lg-12 col-xs-12">';
                    html = html + '<thead style="background-color: #000 !important; color: #fff !important">';
                        html = html + '<tr>';
                            html = html + '<th>S/No</th>';
                            html = html + '<th>Full Names</th>';
                            html = html + '<th>Mobile Number</th>';
                        html = html + '</tr>';
                    html = html + '</thead>';
                    html = html + '<tbody>';
                for(x=0; x<data.uploadedUsersCodes.length; x++)
                {

                    html = html + '<tr>';
                        html = html + '<td>'+(x+1)+'.</td>';
                        html = html + '<td>'+(data.uploadedUsersCodes[x].firstName + ' ' + data.uploadedUsersCodes[x].lastName)+'</td>';
                        html = html + '<td>'+ (data.uploadedUsersCodes[x].phoneNumber) +'</td>';
                    html = html + '</tr>';

                }
                    html = html + '</tbody>';
                html = html + '</table>';

                html = html + '<div class="flex flex-1 items-end">';
				    html = html + '<div class="col col-md-12 col-sm-12 col-xs-12 col-lg-12"><a class="btn btn-primary col col-md-12 col-sm-12 col-xs-12 col-lg-12" onclick="startAfreshMemberUpload()">Start Afresh</a></div>';
				    html = html + '<div class="col col-md-12 col-sm-12 col-xs-12 col-lg-12"><a class="btn btn-success col col-md-12 col-sm-12 col-xs-12 col-lg-12" onclick="uploadTemplate()">Click to Upload Validated Members</a></div>';
			    html = html + '</div>';
                html = html + '<input type="hidden" name="uploadedUsersCodes" id="uploadedUsersCodes" value="'+encodeURIComponent(JSON.stringify(data.uploadedUsersCodes))+'">';
                html = html + '<input type="hidden" name="validatedBulkuploadmembertocooperative" id="validatedBulkuploadmembertocooperative" value="'+(data.cooperative_id)+'">';

                $('#validatedList').html(html);

			}
			else
			{
				toastr.error(data.message);
				var errorList = data.errorList;
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					$('#downloadErrorList').hide();
				}
			}
		},
		error: function (e) {
			toastr.error('We could not upload the new Cooperative members. Please try again');
		}
	});
}


function startAfreshMemberUpload()
{
    $('#bulkuploadmemberdiv').show();
    $('#validatedbulkuploadmemberdiv').hide();
    $('#fileselector').val();
}



function uploadTemplate()
{
	var form = $('#validatedbulkuploadmemberdiv')[0];
	var data = new FormData(form);
	/*$('.floater').hide();
	$('#membershipdueslisting').show();*/
	$.ajax({
		type: "POST",
		url: "/api/upload-bulk-members-to-cooperative",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				toastr.success(data.message);
				console.log(223);
				var errorList = data.errorList;
				console.log(224);
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					console.log(225);
					$('#downloadErrorList').hide();
					console.log(226);
					handleClose();
				}
				var bulkuploadmembertocooperativeId = $('#bulkuploadmembertocooperative').val();
				console.log(222);
				if(data.isMembershipDues!=undefined && data.isMembershipDues!=null && data.isMembershipDues==true)
				{
					loadDuesPaidListingView(bulkuploadmembertocooperativeId, '.: Paid Membership Dues', 1)
				}



			}
			else
			{
				toastr.error(data.message);
				var errorList = data.errorList;
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					$('#downloadErrorList').hide();
				}
			}
		},
		error: function (e) {
			toastr.error('We could not upload the new Cooperative members. Please try again');
		}
	});
}



function uploadTemplateOld()
{
	var form = $('#bulkuploadmemberdiv')[0];
	var data = new FormData(form);
	/*$('.floater').hide();
	$('#membershipdueslisting').show();*/
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/upload-bulk-members-to-cooperative",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				toastr.success(data.message);
				console.log(223);
				var errorList = data.errorList;
				console.log(224);
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					console.log(225);
					$('#downloadErrorList').hide();
					console.log(226);
					handleClose();
				}
				var bulkuploadmembertocooperativeId = $('#bulkuploadmembertocooperative').val();
				console.log(222);
				if(data.isMembershipDues!=undefined && data.isMembershipDues!=null && data.isMembershipDues==true)
				{
					loadDuesPaidListingView(bulkuploadmembertocooperativeId, '.: Paid Membership Dues', 1)
				}



			}
			else
			{
				toastr.error(data.message);
				var errorList = data.errorList;
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					$('#downloadErrorList').hide();
				}
			}
		},
		error: function (e) {
			toastr.error('We could not upload the new Cooperative members. Please try again');
		}
	});
}


function bulkUploadMember(id)
{
	$( "#bulkuploadmembertocooperative" ).val(id);
	document.getElementById('actionTitle').innerHTML = 'Bulk Upload Members';
	$( ".floater" ).hide();
	$( "#bulkuploadmemberdiv" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}


function addMemberToProject(project_id, cooperative_id, coopParentId, minSlot, maxSlot)
{
	console.log(">>>>>>>>>>" + coopParentId);
	handleGetProjectsForAddToProject(project_id, cooperative_id, coopParentId, minSlot, maxSlot);
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Add Member To Project';
	$( "#projectaddnewmember_cooperative" ).val(cooperative_id);
	$( "#projectaddnewmember_project" ).val(project_id);
	$( ".floater" ).hide();
	$( "#addmembertoproject" ).show();



	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}


function uploadMembersToProject(project_id, cooperative_id, coopParentId)
{
	console.log(">>>>>>>>>>" + coopParentId);
	handleGetProjectsForUploadToProject(project_id, cooperative_id, coopParentId);
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Add Member To Project';
	$( "#projectuploadnewmember_cooperative" ).val(cooperative_id);
	$( "#projectuploadnewmember_project" ).val(project_id);
	$( ".floater" ).hide();
	$( "#uploadmemberstoproject" ).show();



	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}




function handleGetProjectsForUploadToProject(project_id, cooperative_id, coopParentId)
{
	$.ajax({
		type: "GET",
		url: "/api/get-projects-and-cooperative-members/" + cooperative_id + "/" + project_id,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var projects = data.project_list;
				$('#projectuploadnewmember_project').empty();
				$('#projectuploadnewmember_project').append($('<option>', {
					value: null,
					text : '--Select A Project--'
				}));
				$.each(projects, function(key, value) {
					console.log(value);
					console.log(key);
					$('#projectuploadnewmember_project').append($('<option>', {
						value: value.id,
						text : value.projectName,
						selected: value.id==project_id ? true : false
					}));
				});
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}



function viewFailedUploads()
{
	var id = $('#bulkuploadmembertocooperative').val();
	var url = '/admin/download-failed-members-list/' + id;
	/*$.ajax({
		type: "GET",
		url: '/admin/download-failed-members-list/' + id,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {

		},
		error: function (e) {
			//console.error(e);
			toastr.error('We experienced issues downloading the template. Please ensure you do not have any ad-blockers turned on');
		}
	});*/
	window.location=url;
}
function downloadTemplate()
{
	var id = $('#bulkuploadmembertocooperative').val();
	var url = '/admin/download-cooperative-member-template/' + id;
	window.location=url;
	/*var id = $('#bulkuploadmembertocooperative').val();
	$.ajax({
		type: "GET",
		url: '/admin/download-cooperative-member-template/' + id,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {

		},
		error: function (e) {
			//console.error(e);
			toastr.error('We experienced issues downloading the template. Please ensure you do not have any ad-blockers turned on');
		}
	});*/
}



function downloadUploadMemberToProjectTemplate()
{
	var id = $('#projectuploadnewmember_cooperative').val();
	var projid = $('#projectuploadnewmember_project').val();
	if(id!=undefined && id!=null && projid!=undefined && projid!=null)
	{
		var url = '/admin/download-add-project-member-template/' + id + '/' + projid;
		//alert(url);
		window.location=url;
	}
}



function uploadMemberToProjectTemplate()
{
	var form = $('#uploadmemberstoproject')[0];
	var data = new FormData(form);
	/*$('.floater').hide();
	$('#membershipdueslisting').show();*/
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/upload-bulk-members-to-project",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				toastr.success(data.message);
				handleClose(1);
				viewProjectMembers(data.project_id,  data.project_name)
			}
			else
			{
				toastr.error(data.message);
				var errorList = data.errorList;
				if(errorList!=undefined && errorList.length>0)
				{
					console.log(errorList.length);
					$('#downloadErrorList').show();
				}
				else
				{
					$('#downloadErrorList').hide();
				}
			}
		},
		error: function (e) {
			toastr.error('We could not upload the new Cooperative members. Please try again');
		}
	});
}


function addMemberToProjectPost()
{
	var form = $('#addmembertoproject')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		url: "/api/add-member-to-project",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				toastr.success(data.message);
				var projectaddnewmember_cooperative = $('#projectaddnewmember_cooperative').val();
				var projectaddnewmember_project = $('#projectaddnewmember_project').val();
				var key = '#' + projectaddnewmember_cooperative + '_' + projectaddnewmember_project;
				var newProjectMemberCount = data.newProjectMemberCount;
				$(key).html(newProjectMemberCount);

				handleClose();
			}
			else
			{
				console.log(33);
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


/*function addMemberToProject(project_id, cooperative_id)
{
	handleGetProjectsForAddToProject(project_id, cooperative_id);
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Add Member To Project';
	$( "#projectaddnewmember_cooperative" ).val(cooperative_id);
	$( "#projectaddnewmember_project" ).val(project_id);
	$( ".floater" ).hide();
	$( "#addmembertoproject" ).show();

	$("#newCompany").animate({
		width: "toggle"
	}, "slow");
}*/


function handleGetProjectsForAddToProject(project_id, cooperative_id, coopParentId, minSlot, maxSlot)
{
	console.log([project_id, cooperative_id, coopParentId, minSlot, maxSlot]);
	var form = $('#addmembertoproject')[0];
	var projectaddnewmember_cooperative = $('#projectaddnewmember_cooperative').val();
	var data = new FormData(form);
	console.log(data);
	url_ = "/api/get-projects-and-cooperative-members";


	var minStrAdvice = "";
	if(minSlot!=undefined && minSlot!=null && maxSlot!=undefined && maxSlot!=null)
	{
		minStrAdvice = "(Minimum of " + minSlot + " and Maximum of " + maxSlot + " slots)";
		$('#numberofslots').attr({"max" : maxSlot, "min" : minSlot});
	}
	else
	{
		if(maxSlot!=undefined && maxSlot!=null)
		{
			minStrAdvice = "(Maximum of " + maxSlot + " slots)";
			$('#numberofslots').attr({"max" : maxSlot});
		}
		else
		{
			if(minSlot!=undefined && minSlot!=null)
			{
				minStrAdvice = "(Minimum of " + minSlot + " slots)";
				$('#numberofslots').attr({"min" : minSlot});
			}
		}
	}
	$('#minStrAdvice').html(minStrAdvice);


	if(coopParentId==null)
	{
		$('#numberofslots').attr("type", "text");
		$('#numberofslots').show();
		$('#numberofslotsforce').hide();
	}
	else
	{
		$('#numberofslots').attr("type", "hidden");
		$('#numberofslots').val(1);
		$('#numberofslots').hide();
		$('#numberofslotsforce').show();
	}


	if(cooperative_id!=undefined && cooperative_id!=null)
	{
		url_ = url_ + "/" + cooperative_id;
		if(project_id!=undefined && project_id!=null)
			url_ = url_ + "/" + project_id;
	}
	$.ajax({
		type: "GET",
		url: "/api/get-projects-and-cooperative-members/" + cooperative_id + "/" + project_id,
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				if(data.cooperative!=undefined && data.cooperative!=null && data.cooperative.parentCompanyId!=null)
				{
					//$('#numberofslots').attr("type", "hidden");
					//$('#numberofslots').val(1);
					//$('#numberofslots').hide();
					//$('#numberofslotsforce').show();
					$('#numberofslots').attr("type", "text");
					$('#numberofslots').show();
					$('#numberofslotsforce').hide();
				}
				else
				{
					$('#numberofslots').attr("type", "text");
					$('#numberofslots').show();
					$('#numberofslotsforce').hide();
				}

				var slots_available = data.slots_available;
				var projects = data.project_list;
				var members = data.member_list;
				$('#projectaddnewmember_project').empty();
				$('#projectaddnewmember_project').append($('<option>', {
					value: null,
					text : '--Select A Project--'
				}));
				$.each(projects, function(key, value) {
					console.log(value);
					console.log(key);
					$('#projectaddnewmember_project').append($('<option>', {
						value: value.id,
						text : value.projectName,
						selected: value.id==project_id ? true : false
					}));
				});
				$('#projectaddnewmember_member').empty();
				/*$('#projectaddnewmember_member').append($('<option>', {
					value: null,
					text : '--Select A Member--'
				}));*/
				$.each(members, function(key, value) {
					console.log(value);
					console.log(key);
					$('#projectaddnewmember_member').append($('<option>', {
						value: value.id,
						text : value.user.first_name + ' ' + value.user.last_name
					}));
				});

				//console.log(slots_available);
				$("#numberofslots").attr({
				   "max" : slots_available,
				});

			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}

function payDuesByCash()
{
	var form = $('#membershipdueslisting')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		url: "/api/pay-membership-dues",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				toastr.success(data.message);
				$( ".floater" ).hide();
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}



function transferDuesToParentCooperative()
{
	var form = $('#membershipdueslisting')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		url: "/api/transfer-paid-dues-to-parent",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				toastr.success(data.message);
				$( ".floater" ).hide();
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function handleClose(hide)
{
	console.log("close div");
	//width:'toggle',
	$("#addbvn-modal-container").animate({"right": "-650px"}, {duration: 1000, complete: function () {
			console.log("close div1");
			if(hide!=undefined && hide==1)
			{

			}
			else
			{
				$("#newCompany").hide();
			}
	}});

}


function addNewProject(id, projectId)
{
	if(projectId!=undefined && projectId!=null)
	{
		var url = "/api/get-project-details/" + projectId;
		$.ajax({
			type: "GET",
			url: url,
			data: [],
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					data =data.details;
					$('#project_edit_id').val(projectId);
					$('#new_project_cooperative').val(data.cooperativeId + "###"+ data.cooperative.companyName);
					$('#new_project_wealth_manager').val(data.wealthManager.id + "###" + data.wealthManager.first_name + ' ' + data.wealthManager.last_name);
					$('#project_name').val(data.projectName);
					$('#slots').val(data.slots);
					$('#slot_amount').val(data.slotAmount);
					$('#slot_every_only').val(data.slotIntervalType=='ONCE' ? 'Once' : 'Every');
					$('#slot_interval_type').val(data.slotIntervalType);
					$('#slot_interval').val(data.slotInterval);
					$('#slot_period').val(data.slotPeriod);
					$('#description').html(data.description);
					if(data.penaltyType!=null && data.data.penalty!=null)
					{
						$('#penaltyApplicable').prop("checked", true);
						$('#penalty').val(data.penaltyType!=null && data.penalty!=null ? data.penalty : '');
						$('#penalty_type').val(data.penaltyType!=null && data.penaltyType!=null ? data.penaltyType : '');
						$('#penalty').show();
						$('#penalty_type').show();
					}
					$('#new_project_button').html("Update Project");
					$( ".floater" ).hide();
					$( "#newprojectdiv" ).show();

					$("#newCompany").show();
					$("#addbvn-modal-container").show();
					$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

					}});
				}
				else
				{
					toastr.error("Invalid project selected. Select a valid project");
					$( ".floater" ).hide();
					$( "#viewexistingprojectdiv" ).hide();

					$("#newCompany").show();
					$("#addbvn-modal-container").show();
					$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

					}});

				}
			},
			error: function (e) {
				toastr.error(e);
			}
		});
	}
	else
	{
		//$( "#newCompany" ).show('slow', 'swing');
		console.log(id);

		$( ".floater" ).hide();
		$( "#cooperative" ).val(id);
		$( "#actionTitle" ).html('Add New Project');
		$( "#newcompanydiv" ).hide();
		$( "#newcustomerdiv" ).hide();
		$( "#startprojectdiv" ).hide();
		$( "#newprojectdiv" ).show();

		$("#newCompany").show();
		$("#addbvn-modal-container").show();
		$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

		}});
	}
}


function handleActivateProject(projectId, projectTitle)
{
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Activate Project';
	$( '#projectid' ).val(projectId);
	$( '#project_title_activate' ).html(projectTitle);
	$( ".floater" ).hide();
	$( "#startprojectdiv" ).show();

	if(document.getElementById('newCompany'))
	{

		$("#newCompany").show();
		$("#addbvn-modal-container").show();
		$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

		}});

	}
}


function viewProject(projectId, projectTitle, projectIdPad)
{
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Project Details - #' + projectIdPad;
	$( '#editprojectid' ).val(projectId);
	$( ".floater" ).hide();
	$( "#viewexistingprojectdiv" ).show();

	if(document.getElementById('newCompany'))
	{
		if(document.getElementById('newCompany').style.display=='none')
		{
			$("#newCompany").show();
			$("#addbvn-modal-container").show();
			$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

			}});
		}
	}

	var url = "/api/get-project-details/" + projectId;
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var investment = data.investment;
				var currentUserRole = data.currentUserRole;
				data =data.details;
				var edit_cooperative_title = data.cooperative.companyName;
				var edit_project_title = data.projectName;
				var edit_project_slots = data.slots + " Slots";
				var edit_project_each_slot_pays = "ZMW" + data.slotAmount + " " + (data.slotIntervalType=='ONCE' ? 'PER SLOT' : ('Every ' + data.slotInterval + data.slotIntervalType));
				var edit_project_max_contributions = data.slotPeriod;
				var edit_project_penalty = "N/A";
				if(data.penaltyType!=undefined && data.penaltyType!=null)
				{
					edit_project_penalty = data.penaltyType=='FLAT_FEE' ? ('ZMW' + data.penalty) : (data.penalty + '%');
				}
				var edit_project_description = data.description;
				var edit_wealth_manager = data.wealthManager!=undefined && data.wealthManager!=null ? (data.wealthManager.first_name + " " + data.wealthManager.last_name) : "N/P";
				var status = data.status;
				var edit_project_amount_invested = investment!=undefined && investment!=null ? investment.amount : 'N/A';
				var edit_project_investment_period = investment!=undefined && investment!=null ? investment.investment_period : 'N/A';
				var edit_project_investment_rate = investment!=undefined && investment!=null ? investment.interest_rate : 'N/A';
				var edit_project_expected_returns = investment!=undefined && investment!=null ? (parseFloat(investment.amount) + parseFloat(investment.interest_expected)) : 'N/A';
				var edit_project_current_valuation = investment!=undefined && investment!=null ? parseFloat(investment.current_valuation) : 'N/A';
				var kickoff_date = data.kickoff_date;


				$('#edit_cooperative_title').html(edit_cooperative_title);
				$('#edit_project_title').html(edit_project_title);
				$('#edit_project_slots').html(edit_project_slots);
				$('#edit_project_each_slot_pays').html(edit_project_each_slot_pays);
				$('#edit_project_max_contributions').html(edit_project_max_contributions);
				$('#edit_project_penalty').html(edit_project_penalty);
				$('#edit_project_description').html(edit_project_description);
				$('#edit_project_status').html(status);
				$('#edit_project_kickoff_date').html(kickoff_date);
				$('#edit_wealth_manager').html(edit_wealth_manager);
				$('#edit_project_amount_invested').html(edit_project_amount_invested);
				$('#edit_project_investment_period').html(edit_project_investment_period);
				$('#edit_project_investment_rate').html(edit_project_investment_rate);
				$('#edit_project_expected_returns').html(edit_project_expected_returns);
				$('#edit_project_current_valuation').html(edit_project_current_valuation);

				if(currentUserRole!=undefined && currentUserRole!=null && currentUserRole.cooperative_id==data.cooperative.id && currentUserRole.role_code=='COMPANY ADMIN')
				{
					if(data.details.slotsTaken==0)
					{
						var html = '<a class="btn btn-success col col-md-12" onclick="editNewProject('+ data.cooperative.id +', '+ projectId +')" style="clear: both !important; pointer: cursor !important">Edit Project</a>';
						$('#editProjectDiv').html(html);
					}
				}
				else
				{
					$('#editProjectDiv').html("");
				}

			}
			else
			{
				toastr.error("Invalid project selected. Select a valid project");
				$( ".floater" ).hide();
				$( "#viewexistingprojectdiv" ).hide();

				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});

			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}


function editNewProject(coopId, projectId)
{
	handleClose();
	addNewProject(coopId, projectId);
}

function activateProject(id)
{
	if(id!=undefined && id!=null)
	{
		$('#projectid').val(id);
	}
	var form = $('#startprojectdiv')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/activate-project",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				$( "#newprojectdiv" ).hide();
				$( "#startprojectdiv" ).hide();
				var key = '#project_count_' + data.cooperative_id;
				$( key ).html(data.project_count);
				handleClose();

				key = $('#projectid').val();
				key = 'projectstatus' + key;
				console.log(key);
				if(document.getElementById(key))
					document.getElementById(key).innerHTML = 'Active';
				toastr.success(data.message);
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function payprojectcontributions(id, cooperative_id)
{
	document.getElementById('actionTitle').innerHTML = 'Pay Project Contributions';
	$( ".floater" ).hide();
	$( "#payprojectcontributions" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}


function viewProjectMembers(projectId, projectTitle)
{

	$('.floater').hide();
	$('#membershipdueslisting').show();
	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
	var html = html + '<table class="table table-hover col col-md-12">';
		html = html + '<thead>';
			html = html + '<tr>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
				html = html + '<th style="background-color: #000 !important; color: #fff !important;">Slots</th>';
			html = html + '</tr>';
		html = html + '</thead>';
		html = html + '<tbody>';
			html = html + '<tr>';
				html = html + '<td colspan="5" style="text-align: center !important;">There are currently No Members On This Project</td>';
			html = html + '</tr>';
		html = html + '</tbody>';
	html = html + '</table>';
	$('#dues-listing-div').html(html==undefined ? '' : html);
	$('#members_listing_project_title').html('Project: ' + projectTitle);

	document.getElementById('actionTitle').innerHTML = 'Project Members';
	var url = "/api/project-member-listing/" + projectId;
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {

			if(data.status==0)
			{
				var details = data.details;
				$('#addCustomerDiv2').show();


				html = '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right">Slots</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
					console.log(details);
					var total = 0;
					var counter = 0;
					var paidIndex = 1;
					//var keys = Object.keys(details);
					//console.log(keys);
					for(var v=0; v<details.length; v++)
					{
						var member = details[v];
						console.log(member);
						counter++;
						html = html + '<tr>';
							html = html + '<td>' + paidIndex++ + '.</td>';
							html = html + '<td>' + member['firstName'] + ' ' + member['lastName'] + '</td>';
							html = html + '<td style="text-align: right">' + member['ct'] + '</td>';
						html = html + '</tr>';
						total = total + (member['ct']);

					}
					if(counter>0)
					{
						html = html + '<tr>';
							html = html + '<td style="background-color: #000 !important; color: #fff !important;">Total Slots</td>';
							html = html + '<td colspan="2" style="background-color: #000 !important; color: #fff !important; text-align: right !important;">' + parseFloat(total) + '</td>';
						html = html + '</tr>';
					}
					else
					{
						html = html + '<tr>';
							html = html + '<td colspan="3" style="text-align: center !important;">There are currently No Members On This Project</td>';
						html = html + '</tr>';
					}
					html = html + '</tbody>';
				html = html + '</table>';
				$('#members-listing-div').html(html);
			}
			else
			{
				//toastr.error(data.message);
				var html = '';
				html = html + '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">&nbsp;</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right">Slots</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
						html = html + '<tr>';
							html = html + '<td colspan="3" style="text-align: center !important;">There are currently No Members On This Project</td>';
						html = html + '</tr>';
					html = html + '</tbody>';
				html = html + '</table>';
				$('#members-listing-div').html(html);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}



function payContributions(project_id, cooperative_id, project_key, cooperative_key)
{
	handleGetProjectsForPayContributions(project_id, cooperative_id);
	document.getElementById('actionTitle').innerHTML = 'Pay Contributions';
	$( ("#"+cooperative_key) ).val(cooperative_id);
	$( ("#"+project_key) ).val(project_id);
	$( ".floater" ).hide();
	$( "#payprojectcontributions" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});

	console.log(project_id);
	getContributionListing(project_id);
}


function handleGetProjectsForPayContributions(project_id, cooperative_id)
{
	var form = $('#addmembertoproject')[0];
	var projectaddnewmember_cooperative = $('#projectaddnewmember_member').val();
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "GET",
		url: "/api/get-projects-and-project-members/" + cooperative_id + "/" + project_id,
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				var slots_available = data.slots_available;
				var projects = data.project_list;
				var members = data.member_list;
				$('#projectpaycontribution_project').empty();
				$('#projectpaycontribution_project').append($('<option>', {
					value: null,
					text : '--Select A Project--'
				}));
				$.each(projects, function(key, value) {
					console.log(value);
					console.log(key);
					$('#projectpaycontribution_project').append($('<option>', {
						value: value.id,
						text : value.projectName,
						selected: value.id==project_id ? true : false
					}));
				});
				$('#projectpaycontribution_member').empty();
				$('#projectpaycontribution_member').append($('<option>', {
					value: null,
					text : '--Select A Member--'
				}));
				console.log(members);
				$.each(members, function(key, value) {
					console.log(value);
					console.log(key);
					$('#projectpaycontribution_member').append($('<option>', {
						value: value.id,
						text : value.cooperativeMember.user.first_name + ' ' + value.cooperativeMember.user.last_name + ' - Slot #' +  value.projectMemberIndex
					}));
				});
				$('#projectpaycontribution_cooperative').val(cooperative_id);


				console.log(slots_available);
				$("#numberofslots").attr({
				   "max" : slots_available,
				});

			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function getContributionListing(selectedProj)
{
	//selectedProj = cooperative_id;
	//var selectedProj = document.getElementById('projectpaycontribution_project').value;
	//var selectedMember = document.getElementById('projectpaycontribution_member').value;
	console.log(selectedProj);
	$.ajax({
		type: "GET",
		url: "/api/contributions-listing/"+selectedProj,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$("#dueslisting").html("");
				var html = '<div class="col col-md-12" style="padding-left: 0px !important;"><strong style="text-decoration: underline">Project Contributions</strong></div>';
				html = html + '<table class="col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; padding-left: 5px !Important" class="col col-md-1"><input type="checkbox" class="selectall" onchange="javascript:handleSelectAll(); handlecheckboxselectorforpaycontributions()" id="selectall" value="1"></th>';
							html = html + '<th style="width: 40% !important; padding-top: 3px !important; padding-bottom: 3px !important; " class="col col-md-1">Member</th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important; padding-right: 0px !important" class="col col-md-5"><strong>Due Details</strong></th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important; padding-right: 0px !important" class="col col-md-6"><strong>Outstanding</strong></th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';

					var totalDue = 0;
					var countCheck = 0;
					console.log(data.list);
					if(data.list!=undefined && data.list.length>0)
					{
						console.log("Start Here");
						$.each(data.list, function(key, value) {
							console.log(value);
							console.log(key);
							var dueAmount = value.amount;
							console.log(dueAmount);
							var penaltyIncurred = value.penaltyIncurred;
							console.log(penaltyIncurred);
							var amountPaid = value.amountPaid;
							console.log(amountPaid);

							var amountDue = ((Number.parseFloat(dueAmount) + Number.parseFloat(penaltyIncurred) - Number.parseFloat(amountPaid)));

							console.log(totalDue);
							console.log(amountDue);
							//totalDue = Number.parseFloat(totalDue).toFixed(2);
							var nf = new Intl.NumberFormat();
							amountDueFormatted = Number.parseFloat(amountDue).toFixed(2);
							const options1 = { style: 'currency', currency: 'ZMW' };
							const numberFormat1 = new Intl.NumberFormat('en-US', options1);
							amountDueFormatted = numberFormat1.format(amountDueFormatted);

							bgcolor = countCheck%2==0 ? 'f5f5f5' : 'ffffff';
							if(amountDue>0)
							{
								totalDue = totalDue + amountDue;
								html = html + '<tr>';
										html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #'+bgcolor+'">';
											html = html + '<input class="payselector checker" onchange="handlecheckboxselectorforpaycontributions()" type="checkbox" name="projectcontributionscheckbox[]" value="' + value.id + '###' + (parseFloat(value.amount) + parseFloat(value.penaltyIncurred) - parseFloat(value.amountPaid))+'">';
										html = html + '</td>';

										html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #'+bgcolor+'">';
											html = html + value.memberName;
										html = html + '</td>';
										html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
											html = html + value.dueDate;
										html = html + '</td>';
										html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
											html = html + amountDueFormatted;
										html = html + '</td>';
								html = html + '</tr>';
							}


							countCheck++;
						});

						console.log(totalDue);
						if(totalDue==0)
						{
							html = html + '<tr>';
								html = html + '<td colspan="4" style="text-align: center !important; padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #f5f5f5">';
									html = html + 'There are no outstanding project contributions';
								html = html + '</td>';
							html = html + '</tr>';
						}
					}
					else
					{
						html = html + '<tr>';
								html = html + '<td colspan="4" style="text-align: center !important; padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #f5f5f5">';
									html = html + 'There are no outstanding project contributions';
								html = html + '</td>';
						html = html + '</tr>';
					}
					html = html + '</tbody>';


					html = html + '<tfooter style="background-color: #000; color: #fff">';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
								html = html + '<td colspan="3" style="padding-top: 3px !important; padding-bottom: 3px !important; padding-left: 5px !important; ">Total Selected</td>';
								html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important;" id="totalSelectedTable">';
									html = html + 'ZMW 0. 00';
								html = html + '</td>';
						html = html + '</tr>';
					html = html + '</tfooter>';
				html = html + '</table>';

				html = html + '<div class="col col-md-12 items-end" id="payProjectContributionsPayButton" style="display: none !important; padding:0px !important; padding-top: 20px !important;">';
					html = html + '<a class="btn btn-success col col-md-12" onclick="payProjectContribution()">Pay Dues</a>';
				html = html + '</div>';
				console.log(html);
				$('#dueslisting').html(html);
				$('#dueslisting').show();
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function handlecheckboxselectorforpaycontributions()
{
	console.log('selected');
	var allCheckboxes = $('.payselector');
	console.log('allCheckboxes');
	var total = 0.00;
	var totalFormatted = 'ZMW 0. 00';
	allCheckboxes.each(function (index, obj) {
		//console.log(obj.checked);
		//console.log(obj.value);
		if (obj.checked === true) {
			var val = obj.value;
			val = val.split('###')[1];
			val = parseFloat(val);
			console.log(val);
			total = total + (val);
			console.log('total = ' + total);
			totalFormatted = Number.parseFloat(total).toFixed(2);
			const options1 = { style: 'currency', currency: 'ZMW' };
			const numberFormat1 = new Intl.NumberFormat('en-US', options1);
			totalFormatted = numberFormat1.format(totalFormatted);
		}
		$('#totalSelectedTable').html(totalFormatted)
		if(total>0)
			$('#payProjectContributionsPayButton').show();
		else
			$('#payProjectContributionsPayButton').hide();
	});

	$('#textbox1').val(this.checked);

}


function payProjectContribution()
{
	var form = $('#payprojectcontributions')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/pay-project-contributions",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				$( "#newprojectdiv" ).hide();
				$( "#startprojectdiv" ).show();
				$( '#projectid' ).val(data.project_id);
				$( '#project_title_activate' ).html(data.project_title);
				toastr.success(data.message);
				handleClose();
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function viewProjectContributions(selectedProj, projectName)
{
	document.getElementById('actionTitle').innerHTML = 'Project Contributions Paid';
	document.getElementById('projectcontributionstitle').innerHTML = "Project: " + projectName;
	$( ".floater" ).hide();
	$( "#paidcontributionslisting" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});

	console.log(selectedProj);

	console.log(selectedProj);
	$.ajax({
		type: "GET",
		url: "/api/contributions-paid-listing/"+selectedProj,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var projectSelected = data.project;
				$("#paiddueslisting").html("");
				var html = '<div class="col col-md-12" style="padding-left: 0px !important;"><strong style="text-decoration: underline">Project Contributions</strong></div>';
				html = html + '<input type="hidden" name="cooperative" value='+ (data.cooperative!=undefined && data.cooperative!=null ? data.cooperative.id : '') +'>';
				html = html + '<input type="hidden" name="project" value="'+ selectedProj +'">';
				html = html + '<table class="col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; padding-left: 5px !important" class="col col-md-1"><input type="checkbox" class="selectall" onchange="javascript:handleSelectAll(); handlecheckboxfortransfer()" id="selectall" value="1"></th>';
							html = html + '<th style="width: 30% !important; padding-top: 3px !important; padding-bottom: 3px !important; " class="col col-md-1">Member</th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important; padding-right: 0px !important" class="col col-md-5"><strong>Date Paid</strong></th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; " class="col col-md-1">Status</th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important; padding-right: 0px !important" class="col col-md-6"><strong>Amount</strong></th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';

					var totalDue = 0;
					var countCheck = 0;

					if(data.list!=undefined && data.list.length>0)
					{
						var investYes = false;
						$.each(data.list, function(key, value) {
							console.log(value);
							console.log(key);
							var dueAmount = value.amount;
							console.log(dueAmount);
							var penaltyIncurred = value.penaltyIncurred;
							console.log(penaltyIncurred);
							var amountPaid = value.amountPaid;
							console.log(amountPaid);

							var amountPaid = ((Number.parseFloat(amountPaid)));

							console.log(totalDue);
							//totalDue = Number.parseFloat(totalDue).toFixed(2);
							var nf = new Intl.NumberFormat();
							amountDueFormatted = Number.parseFloat(amountPaid).toFixed(2);
							const options1 = { style: 'currency', currency: 'ZMW' };
							const numberFormat1 = new Intl.NumberFormat('en-US', options1);
							amountDueFormatted = numberFormat1.format(amountDueFormatted);

							bgcolor = countCheck%2==0 ? 'f5f5f5' : 'ffffff';

							totalDue = totalDue + amountPaid;
							html = html + '<tr>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #'+bgcolor+'">';
										//html = html + (countCheck+1)+'.';
										if(data.userRole=='COMPANY ADMIN')
											if(value.status=='Paid')
											{
												investYes = true;
												html = html + '<input class="checker selector handlecheckboxfortransfer" onchange="handlecheckboxfortransfer()" type="checkbox" name="contributions[]" value="' + value.projectContributionPaymentId + '###' + ((value.amountPaid))+'">';
											}
											else
											{
												html = html + 'I';
											}
										else
											html = html + (countCheck+1)+'.';
									html = html + '</td>';

									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #'+bgcolor+'">';
										html = html + value.memberName;
									html = html + '</td>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
										html = html + value.datePaid;
									html = html + '</td>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: center !important; background-color: #'+bgcolor+'">';
										html = html + value.status;
									html = html + '</td>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
										html = html + amountDueFormatted;
									html = html + '</td>';
							html = html + '</tr>';


							countCheck++;
						});



						if(totalDue==0)
						{
							html = html + '<tr>';
								html = html + '<td colspan="5" style="text-align: center !important; padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #f5f5f5">';
									html = html + 'There are no paid project contributions';
								html = html + '</td>';
							html = html + '</tr>';
						}
						else
						{
							console.log(totalDue);
							amountDueFormatted = parseFloat(totalDue).toFixed(2);
							console.log(amountDueFormatted);
							const options1 = { style: 'currency', currency: 'ZMW' };
							const numberFormat1 = new Intl.NumberFormat('en-US', options1);
							totalDueFormatted = numberFormat1.format(amountDueFormatted);
							html = html + '<tr>';
									html = html + '<td colspan="3" style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: left !important; background-color: #000;  color: #fff">';
										html = html + '<strong>Total Paid</strong>';
									html = html + '</td>';
									html = html + '<td colspan="2" style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #000; color: #fff">';
										html = html + totalDueFormatted;
									html = html + '</td>';
							html = html + '</tr>';

							if(investYes==true)
							{
								html = html + '<tr>';
										html = html + '<td colspan="3" style="border-top: 1px solid #fff; padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: left !important; background-color: #000;  color: #fff">';
											html = html + '<strong>Total Amount Selected</strong>';
										html = html + '</td>';
										html = html + '<td colspan="2" style="border-top: 1px solid #fff; padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #000; color: #fff" id="totalAmountTransfer">';
											html = html + "ZMW 0. 00";
										html = html + '</td>';
								html = html + '</tr>';
								html = html + '<tr style="">';
									html = html + '<td colspan="5" style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: left !important; color: #000">';

										html = html + '<div style="font-weight: bold !important; text-decoration: underline; padding-top: 10px !important;">Invest Funds With A Wealth Manager</div>';

										html = html + '<div class="col-md-4" style="font-weight: bold !important; text-decoration: underline; padding-top: 10px !important;">';
											html = html + '<label style="padding-top: 10px !important; font-weight: 100 !important;">Wealth Manager:</label><br>';
											html = html + '<select onchange="javascript:handleWealthManagerSelect()" class="textfieldclass col col-md-12 typeselect" style="margin-right: 0px !important; float: left !important" name="transferWealthManager" id="transferWealthManager">';
												html = html + '<option value="-1">--Select One--</option>';
												for(var k9=0; k9<data.wealthManagers.length; k9++)
												{
													if(projectSelected.wealth_manager_user_id!=undefined && projectSelected.wealth_manager_user_id!=null &&
														projectSelected.wealth_manager_user_id==data.wealthManagers[k9].id)
													{
														html = html + '<option value="' + data.wealthManagers[k9].id + '">' + data.wealthManagers[k9].fullName + ' - ' + data.wealthManagers[k9].mobileNumber + '</option>';
													}
													else
													{
														if(projectSelected.wealth_manager_user_id!=undefined && projectSelected.wealth_manager_user_id!=null)
														{

														}
														else
														{
															html = html + '<option value="' + data.wealthManagers[k9].id + '">' + data.wealthManagers[k9].fullName + ' - ' + data.wealthManagers[k9].mobileNumber + '</option>';
														}
													}
												}
											html = html + '</select>';
										html = html + '</div>';


										html = html + '<div class="col-md-4" style="font-weight: bold !important; text-decoration: underline; padding-top: 10px !important;">';
											html = html + '<label style="padding-top: 10px !important; font-weight: 100 !important;">Expected Interest Rate (%):</label><br>';
											html = html + '<input type="number" class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: left !important" name="investmentrate" id="investmentrate">';
										html = html + '</div>';


										html = html + '<div class="col-md-4" style="font-weight: bold !important; text-decoration: underline; padding-top: 10px !important;">';
											html = html + '<label style="padding-top: 10px !important; font-weight: 100 !important;">Investment Period (Days):</label><br>';
											html = html + '<input type="number" class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: left !important" name="investmentperiod" id="investmentperiod">';
										html = html + '</div>';


										html = html + '<div class="col-md-12" style="font-weight: bold !important; text-decoration: underline; padding-top: 10px !important;">';
											html = html + '<a onclick="javascript:handleInvestWithWealthManager()" id="investbutton" style="display: none !important; clear: both !important" class="col col-md-12 btn btn-success">Transfer Funds To Wealth Manager</a>';
										html = html + '</div>';




									html = html + '</td>';
								html = html + '</tr>';
							}
						}
					}
					else
					{
						html = html + '<tr>';
								html = html + '<td colspan="5" style="text-align: center !important; padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #f5f5f5">';
									html = html + 'There are no paid project contributions';
								html = html + '</td>';
						html = html + '</tr>';
					}
					html = html + '</tbody>';
				html = html + '</table>';

				//html = html + '<div class="col col-md-12 items-end" id="payProjectContributionsPayButton" style="display: none !important; padding:0px !important; padding-top: 20px !important;">';
				//	html = html + '<a class="btn btn-success col col-md-12" onclick="payProjectContribution()">Transfer To Wealth Manager</a>';
				//html = html + '</div>';
				console.log(html);
				$('#paiddueslisting').html(html);
				$('#paiddueslisting').show();
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}

function handleActivateInvestment(id, type)
{
	$.ajax({
		type: "GET",
		url: "/api/activate-investment/"+id + '/' + type,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var id_ = '#investmentstatus' + id;
				if(data.statusMessage!=undefined && data.statusMessage!=null)
				{
					$(id_).html(data.statusMessage);
				}
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}

function handleWealthManagerSelect()
{
	if($('#transferWealthManager').val()=="-1")
		$('#investbutton').hide();
	else
		$('#investbutton').show();
}


function handlecheckboxfortransfer()
{
	selectedCheckboxes = $('.handlecheckboxfortransfer');
	var totalAmount = 0;
	for(var j1=0; j1<selectedCheckboxes.length; j1++)
	{
		if(selectedCheckboxes[j1].checked)
		{
			console.log(selectedCheckboxes[j1]);
			console.log(selectedCheckboxes[j1].value);
			totalAmount = totalAmount + parseFloat(selectedCheckboxes[j1].value.split('###')[1]);
		}
	}
	totalFormatted = Number.parseFloat(totalAmount).toFixed(2);
	const options1 = { style: 'currency', currency: 'ZMW' };
	const numberFormat1 = new Intl.NumberFormat('en-US', options1);
	totalAmountFormatted = numberFormat1.format(totalFormatted);
	$('#totalAmountTransfer').html(totalAmountFormatted);
}

function handleInvestWithWealthManager()
{
	var form = $('#paidcontributionslisting')[0];
	console.log(form);
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/invest-funds-with-wealth-manager",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status!=undefined && data.status===0)
			{
				$( ".floater" ).hide();
				$("#newCompany").show();
				handleClose();

				toastr.success(data.message);
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function addCooperativeStepThree()
{
	var form = $('#newpersonneldiv')[0];
	console.log(form);
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/add-cooperative-personnel",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status!=undefined && data.status===0)
			{
				handleClose();
				var allUsers = data.allUsers;
				toastr.success(data.message);
				$.each(allUsers, function(key, value) {
					$('#fn'+value[1].id).html(value[0].first_name + ' ' + value[0].last_name);
					$('#em'+value[1].id).html(value[0].email_address);
					$('#mn'+value[1].id).html(value[0].mobile_number);
					$('#st'+value[1].id).html(value[1].status);
					$('#rl'+value[1].id).html(value[1].role_code);
					$('#upd'+value[1].id).html(value[1].updated_at);
				});
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function checkMembershipFeesChange()
{
	if(document.getElementById('membershipFeesCheckbox').checked)
	{
		$('#membershipintervaltype').show();
		$('#membershipfees').show();
		$('#membershipinterval').show();
		$('#every_only').show();
	}
	else
	{
		$('#membershipintervaltype').hide();
		$('#membershipfees').hide();
		$('#membershipinterval').hide();
		$('#every_only').hide();
	}
}

function checkRegistrationFeesChange()
{
	if(document.getElementById('registrationFeesCheckbox').checked)
	{
		$('#registrationFees').show();
		$('#groupRegistrationFees').show();
	}
	else
	{
		$('#registrationFees').hide();
		$('#groupRegistrationFees').show();
	}
}

function checkRegistrationFeesGroupChange()
{
	if(document.getElementById('registrationFeesGroupCheckbox').checked)
	{
		$('.registrationGroupFeesAmount').show();
		$('.registrationGroupFeesMin').show();
		$('.registrationGroupFeesMax').show();
		$('#addGroupCheckBox').show();
	}
	else
	{
		$('.registrationGroupFeesAmount').hide();
		$('.registrationGroupFeesMin').hide();
		$('.registrationGroupFeesMax').hide();
		$('#addGroupCheckBox').hide();
	}
}

function addGroupCheckBox()
{
	var groupRegId = $('#groupRegId');
	var newelement = document.createElement('DIV');
	var html = "";
	html = html + '<input class="textfieldclass col col-md-4 mx-1 registrationGroupFeesAmount" name="registrationGroupFeesAmount[]" placeholder="Amount" type="tel" style="background-image: url(&quot;data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' version=\'1.1\' height=\'50px\' width=\'120px\'><text x=\'65%\' y=\'25\' fill=\'black\' font-size=\'16\'>ZMW</text></svg>&quot;); margin-left: 0px !important;" value="">';
	html = html + '<input class="textfieldclass col col-md-3 mx-1 registrationGroupFeesMin" name="registrationGroupFeesMin[]" placeholder="Min. Members" type="tel" style="margin-left: 0px !important;" value="">';
	html = html + '<input class="textfieldclass col col-md-3 mx-1 registrationGroupFeesMax" name="registrationGroupFeesMax[]" placeholder="Max. Members" type="tel" style="margin-left: 0px !important;" value="">';
	html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
	newelement.innerHTML = html;
	var allfields_ = document.getElementById('groupRegId');
	allfields_.appendChild(newelement);
}


function addCooperativeStepTwo()
{
	var form = $('#steptwocooperative')[0];
	var data = new FormData(form);
	var constitution = $('#constitution').val();
	var membershipfees = $('#membershipfees').val();
	var membershipintervaltype = $('#membershipintervaltype').val();
	var membershipinterval = $('#membershipinterval').val();
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/update-cooperative-dues",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				$( "#steponecooperative" ).hide();
				$( "#steptwocooperative" ).hide();
				//$( "#stepthreecooperative" ).show();
				//$( "#newpersonneldiv" ).show();
				//var coop = data.cooperative;
				addNewPersonnel(data.cooperative_id, data.companyName, null);
				toastr.success(data.message);
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function handleNewCooperative(coopId)
{
	console.log(coopId);
	//$( "#newCompany" ).show('slow', 'swing');
	if(coopId!=undefined && coopId!=null)
	{
		$.ajax({
			type: "GET",
			url: "/api/get-cooperative-details/"+coopId,
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					$('#createCoopButton').html("Save & Continue");
					$('#createCoopButton').removeClass("btn-success").addClass("btn-primary");
					document.getElementById('actionTitle').innerHTML = '.: Update Cooperative';
					$( ".floater" ).hide();
					$( "#steponecooperative" ).show();

					var company_data = data.data;
					$('#company_name').val(company_data.companyName);
					$('#parentcompany').val(company_data.parentCompanyId!=undefined && company_data.parentCompanyId!=null ? company_data.parentCompanyId : "");
					$('#company_address').val(company_data.companyAddress);
					$('#company_email').val(company_data.companyEmail);
					$('#countryCode').val(company_data.priCountryPrefix);
					$('#pri_phone').val(company_data.primaryPhone.substr(company_data.priCountryPrefix.length));
					$('#altcountryCode').val(company_data.altCountryPrefix);
					$('#alt_phone').val(company_data.alternativePhone.substr(company_data.altCountryPrefix.length));
					$('#cooperative_id').val(coopId);

					$("#newCompany").show();
					$("#addbvn-modal-container").show();
					$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

					}});
				}
				else
				{
					toastr.error(data.message);
				}
			},
			error: function (e) {
				toastr.error(data.message);
			}
		});
	}
	else
	{
		$('#createCoopButton').html("Proceed To Create New Cooperative");
		$('#createCoopButton').removeClass("btn-primary").addClass("btn-success");
		document.getElementById('actionTitle').innerHTML = 'Setup A New Cooperative';
		$( ".floater" ).hide();
		$( "#steponecooperative" ).show();

		$("#newCompany").show();
		$("#addbvn-modal-container").show();
		$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

		}});
	}
}

function createNewCooperative()
{
	var form = $('#steponecooperative')[0];
	var data = new FormData(form);
	var logo = $('#logo')[0].files;
	var company_name = $('#company_name').val();

	var company_address = $('#company_address').val();
	var company_email = $('#company_email').val();
	var pri_phone = $('#pri_phone').val();
	var alt_phone = $('#alt_phone').val();
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/create-new-cooperative",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				console.log(data);
				console.log(data.message);
				toastr.success(data.message);
				$( "#step_two_cooperative_id" ).val(data.cooperative_id);
				$( "#step_three_cooperative_id" ).val(data.cooperative_id);
				//$( "#steponecooperative" ).hide();
				//$( "#stepthreecooperative" ).hide();
				handleClose();
				handleNewCooperativeStepTwo(data.cooperative_id);
				/*console.log(2222);
				$( ".floater" ).hide();
				$( "#steptwocooperative" ).show();
				console.log(2224);
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {
					console.log(2225);
				}});*/
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error('We could not create the new Cooperative. Please try again');
		}
	});
}



function handleNewCooperativeStepTwo(coopId)
{
	console.log(coopId);
	//$( "#newCompany" ).show('slow', 'swing');
	if(coopId!=undefined && coopId!=null)
	{
		$.ajax({
			type: "GET",
			url: "/api/get-cooperative-details/"+coopId,
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				console.log(data);
				if(data.status==0)
				{
					$('#addCoopStepTwoButton').html("Save & Continue");
					$('#addCoopStepTwoButton').removeClass("btn-success").addClass("btn-primary");
					document.getElementById('actionTitle').innerHTML = '.: Update Cooperative - Step Two';
					$( ".floater" ).hide();
					$( "#steptwocooperative" ).show();

					var company_data = data.data;
					$('#constitution').html(company_data.constitution);
					$('#membershipFeesCheckbox').prop('checked', company_data.duesApplicable==null ? false : true);
					$('#membershipfees').val(company_data.duesApplicable);
					checkMembershipFeesChange();
					if(company_data.membershipIntervalType!='ONCE')
					{
						$('#every_only').val("Every");
						$('#membershipintervaltype').val(company_data.membershipIntervalType);
						$('#membershipinterval').val(company_data.membershipinterval==null ? "" : company_data.membershipinterval);
					}
					else
					{
						$('#every_only').val("Once");
						$('#membershipintervaltype').hide();
						$('#membershipinterval').hide();
					}

					if(data.registrationGroupFees!=undefined && data.registrationGroupFees!=null)
					{

						var groupRegId = $('#groupRegId');
						for(var t1=0; t1<data.registrationGroupFees.length; t1++)
						{
							if(data.registrationGroupFees[t1].type=='SINGLE')
							{
								$('#registrationFeesCheckbox').prop('checked', true);
								$('#registrationFees').val(data.registrationGroupFees[t1].amount);
								checkRegistrationFeesChange();
							}
							else
							{
								$('#registrationFeesGroupCheckbox').prop('checked', true);
								var newelement = document.createElement('DIV');
								var html = "";
								html = html + '<input class="textfieldclass col col-md-4 mx-1 registrationGroupFeesAmount" name="registrationGroupFeesAmount[]" placeholder="Amount" type="tel" style="background-image: url(&quot;data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' version=\'1.1\' height=\'50px\' width=\'120px\'><text x=\'65%\' y=\'25\' fill=\'black\' font-size=\'16\'>ZMW</text></svg>&quot;); margin-left: 0px !important;" value="'+data.registrationGroupFees[t1].amount+'">';
								html = html + '<input class="textfieldclass col col-md-3 mx-1 registrationGroupFeesMin" name="registrationGroupFeesMin[]" placeholder="Min. Members" type="tel" style="margin-left: 0px !important;" value="'+data.registrationGroupFees[t1].minimumPeople+'">';
								html = html + '<input class="textfieldclass col col-md-3 mx-1 registrationGroupFeesMax" name="registrationGroupFeesMax[]" placeholder="Max. Members" type="tel" style="margin-left: 0px !important;" value="'+data.registrationGroupFees[t1].maximumPeople+'">';
								html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
								newelement.innerHTML = html;
								var allfields_ = document.getElementById('groupRegId');
								allfields_.appendChild(newelement);
							}
						}
					}
					else
					{
						$('#registrationFeesCheckbox').prop('checked', company_data.registrationFee==null ? false : true);
						$('#registrationFees').val(company_data.registrationFee==null ? '' : company_data.registrationFee);
						checkRegistrationFeesChange();
					}
					$('#step_two_cooperative_id').val(company_data.id);

					$("#newCompany").show();
					$("#addbvn-modal-container").show();
					$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

					}});
				}
				else
				{
					toastr.error(data.message);
				}
			},
			error: function (e) {
				toastr.error('We could not find the selected cooperative. Please try again');
			}
		});
	}
	else
	{
		$('#createCoopButton').html("Proceed to Update Fees Applicable");
		$('#createCoopButton').removeClass("btn-primary").addClass("btn-success");
		document.getElementById('actionTitle').innerHTML = 'Setup A New Cooperative - Step Two';
		$( ".floater" ).hide();
		$( "#steptwocooperative" ).show();

		$("#newCompany").show();
		$("#addbvn-modal-container").show();
		$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

		}});
	}
}

/*
function addCooperativeStepThree()
{
	var form = $('#stepthreecooperative')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/add-cooperative-personnel",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			$( "#steponecooperative" ).hide();
			$( "#steptwocooperative" ).hide();
			$( "#stepthreecooperative" ).hide();
			$("#newCompany").show();
			$("#addbvn-modal-container").show();
			$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

			}});
			toastr.success(data.message);
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}
*/


function addAdministrativeStaff()
{
	document.getElementById('actionTitle').innerHTML = 'Project Contributions Paid';
	$( ".floater" ).hide();
	$( "#newadministrativestaff" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});

}


function handleUserRoleChange(elem, id)
{
	console.log(elem.value);
	var key = '#cooperative_id' + id;
	var key1 = '#position' + id;
	var key2 = 'position' + id;
	//key2 = document.getElementById(key2);
	console.log($(key1));
	$(key1).empty();
	$(key1).append($('<option>', {
		value: null,
		text : '--Members Position--'
	}));
	if(elem.value=='COMPANY ADMIN')
	{
		$(key).show();
		var positions = [];
		positions['CHAIRMAN'] = 'Chairman';
		positions['SECRETARY'] = 'Secretary';
		positions['DIRECTOR'] = 'Director';
		positions['ADMIN'] = 'Administrator';
		console.log(positions);
		var p = Object.keys(positions);
		for(var t=0; t<p.length; t++)
		{
			console.log(p[t]);
			console.log(positions[p[t]]);
			console.log(key2);
			/*$(key1).append($('<option>', {
				value: p[t],
				text : positions[p[t]]
			}));*/
			var x = document.getElementById(key2);
			var option = document.createElement("option");
			option.text = p[t];
			option.text = positions[p[t]];
			x.add(option);
		}

	}
	else if(elem.value=='WEALTH MANAGER')
	{
		$(key).hide();
		var positions = [];
		positions['WEALTH MANAGER'] = 'WEALTH MANAGER';
		console.log(positions);
		var p = Object.keys(positions);
		for(var t=0; t<p.length; t++)
		{
			console.log(p[t]);
			console.log(positions[p[t]]);
			$(key1).append($('<option>', {
				value: p[t],
				text : positions[p[t]],
				//selected: key==project_id ? true : false
			}));
		}
	}
	else if(elem.value=='TREASURER')
	{
		$(key).show();
		var positions = [];
		positions['TREASURER'] = 'TREASURER';
		console.log(positions);
		var p = Object.keys(positions);
		for(var t=0; t<p.length; t++)
		{
			console.log(p[t]);
			console.log(positions[p[t]]);
			$(key1).append($('<option>', {
				value: p[t],
				text : positions[p[t]],
				//selected: key==project_id ? true : false
			}));
		}
	}
	else if(elem.value=='SUPER ADMIN')
	{
		$(key).hide();
		var positions = [];
		console.log(positions);
		var p = Object.keys(positions);
		for(var t=0; t<p.length; t++)
		{
			console.log(p[t]);
			console.log(positions[p[t]]);
			$(key1).append($('<option>', {
				value: p[t],
				text : positions[p[t]],
				//selected: key==project_id ? true : false
			}));
		}
	}
}


function signInToPortal()
{
	var form = $('#loginform')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		url: "/api/auth/login",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {

			console.log(data);
			if(data.status==0)
			{
				toastr.success("Welcome " + data.fullname + "!");
				//alert(33);
				window.location.href="/dashboard"
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error('We could not create the new Cooperative. Please try again');
		}
	});
}


function handlecheckboxselector()
{
	console.log('selected');
	var allCheckboxes = $('.selector');
	console.log('allCheckboxes');
	var total = 0.00;
	var totalFormatted = 'ZMW 0. 00';
	allCheckboxes.each(function (index, obj) {
		//console.log(obj.checked);
		//console.log(obj.value);
		if (obj.checked === true) {
			var val = obj.value;
			val = val.split('###')[1];
			val = parseFloat(val);
			console.log(val);
			total = total + (val);
			console.log('total = ' + total);
			totalFormatted = Number.parseFloat(total).toFixed(2);
			const options1 = { style: 'currency', currency: 'ZMW' };
			const numberFormat1 = new Intl.NumberFormat('en-US', options1);
			totalFormatted = numberFormat1.format(totalFormatted);
		}
		$('#totalSelectedTable').html(totalFormatted)
		if(total>0)
			$('#payMembershipDuesPayButton').show();
		else
			$('#payMembershipDuesPayButton').hide();
	});

	$('#textbox1').val(this.checked);

}

function payMembershipDues()
{
	var form = $('#payduescontribution')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/pay-cooperative-dues",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				$( "#newprojectdiv" ).hide();
				$( "#startprojectdiv" ).show();
				$( '#projectid' ).val(data.project_id);
				$( '#project_title_activate' ).html(data.project_title);
				toastr.success(data.message);
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}










function payDues(id, userId)
{
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('duespaymentcooperative').value = id;
	document.getElementById('actionTitle').innerHTML = 'Pay Membership Dues';
	$( ".floater" ).hide();
	$( "#payduescontribution" ).show();
	$("#dueslisting").html("");
	$("#duespaymentsmember").val("-1");
    if(userId!=undefined && userId!=null)
    {

    }
    else
    {
	    getMembershipList();
    }

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {
	    getDuesListing(userId)
	}});
}

function getDuesListing(userId)
{
	var selectedCoop = document.getElementById('duespaymentcooperative').value;

	var selectedMember = null;
    if(userId!=undefined && userId!=null)
        selectedMember = userId;
    else
        selectedMember = document.getElementById('duespaymentsmember').value;
	console.log(selectedCoop);
	$.ajax({
		type: "GET",
		url: "/api/dues-listing/"+selectedCoop+"/"+selectedMember,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$("#dueslisting").html("");
				var html = '<div class="col col-md-12" style="padding-left: 0px !important;"><strong style="text-decoration: underline">Registration Fees</strong></div>';
				html = html + '<table class="col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; " class="col col-md-1">&nbsp;</th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right;" class="col col-md-6" style="text-align: right !important; padding-right: 0px !important"><strong>Outstanding</strong></th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';

					var totalDue = 0;
					var countCheck = 0;
					$.each(data.registrationFeesList, function(key, value) {
						console.log(value);
						console.log(key);
						var amount = value.amount;
						console.log(amount);

						var amountDue = ((Number.parseFloat(amount)));
						totalDue = totalDue + amount;
						console.log(totalDue);
						totalDue = Number.parseFloat(totalDue).toFixed(2);
						var nf = new Intl.NumberFormat();
						amountDueFormatted = Number.parseFloat(amountDue).toFixed(2);
						const options1 = { style: 'currency', currency: 'ZMW' };
						const numberFormat1 = new Intl.NumberFormat('en-US', options1);
						amountDueFormatted = numberFormat1.format(amountDueFormatted);

						bgcolor = countCheck%2==0 ? 'f5f5f5' : 'ffffff';
						if(amountDue>0)
						{
							html = html + '<tr>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #'+bgcolor+'">';
										html = html + '<input class="selector" onchange="handlecheckboxselector()" type="checkbox" name="reg[]" value="' + value.id + '###' + (parseFloat(value.amount))+'">';
									html = html + '</td>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
										html = html + amountDueFormatted;
									html = html + '</td>';
							html = html + '</tr>';
						}
						countCheck++;
					});
					html = html + '</tbody>';


					html = html + '<tfooter style="background-color: #000; color: #fff">';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
								html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-left: 5px !important; ">Total Selected</td>';
								html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important;" id="totalSelectedTable">';
									html = html + 'ZMW 0. 00';
								html = html + '</td>';
						html = html + '</tr>';
					html = html + '</tfooter>';
				html = html + '</table>';
				html = html + '<div class="col col-md-12 items-end" id="" style="padding:0px !important; padding-top: 20px !important;">';
					html = html + '&nbsp;';
				html = html + '</div>';








                html = html + '<div class="col col-md-12" style="padding-top: 20px !Important; padding-left: 0px !important;"><strong style="text-decoration: underline">Membership Dues</strong></div>';
				html = html + '<table class="col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; " class="col col-md-1">&nbsp;</th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right;" class="col col-md-5" style="text-align: right !important; padding-right: 0px !important"><strong>Due Date</strong></th>';
							html = html + '<th style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right;" class="col col-md-6" style="text-align: right !important; padding-right: 0px !important"><strong>Outstanding</strong></th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';

					//var countCheck = 0;
					$.each(data.duesList, function(key, value) {
						console.log(value);
						console.log(key);
						var dueAmount = value.dueAmount;
						console.log(dueAmount);
						var penaltyIncurred = value.penaltyIncurred;
						console.log(penaltyIncurred);
						var amountPaid = value.amountPaid;
						console.log(amountPaid);

						var amountDue = ((Number.parseFloat(dueAmount) + Number.parseFloat(penaltyIncurred) - Number.parseFloat(amountPaid)));
						totalDue = totalDue + amountDue;
						console.log(totalDue);
						totalDue = Number.parseFloat(totalDue).toFixed(2);
						var nf = new Intl.NumberFormat();
						amountDueFormatted = Number.parseFloat(amountDue).toFixed(2);
						const options1 = { style: 'currency', currency: 'ZMW' };
						const numberFormat1 = new Intl.NumberFormat('en-US', options1);
						amountDueFormatted = numberFormat1.format(amountDueFormatted);

						bgcolor = countCheck%2==0 ? 'f5f5f5' : 'ffffff';
						if(amountDue>0)
						{
							html = html + '<tr>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; padding-left: 5px !important; background-color: #'+bgcolor+'">';
										html = html + '<input class="selector" onchange="handlecheckboxselector()" type="checkbox" name="dues[]" value="' + value.id + '###' + (parseFloat(value.dueAmount) + parseFloat(value.penaltyIncurred) - parseFloat(value.amountPaid))+'">';
									html = html + '</td>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
										html = html + value.dueDate.split(' ')[0];
									html = html + '</td>';
									html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; padding-right: 5px !important; text-align: right !important; background-color: #'+bgcolor+'">';
										html = html + amountDueFormatted;
									html = html + '</td>';
							html = html + '</tr>';
						}
						countCheck++;
					});
					html = html + '</tbody>';


					html = html + '<tfooter style="background-color: #000; color: #fff">';
						html = html + '<tr style="background-color: #000 !important; color: #fff !important;">';
								html = html + '<td colspan="2" style="padding-top: 3px !important; padding-bottom: 3px !important; padding-left: 5px !important; ">Total Selected</td>';
								html = html + '<td style="padding-top: 3px !important; padding-bottom: 3px !important; text-align: right !important;" id="totalSelectedTable">';
									html = html + 'ZMW 0. 00';
								html = html + '</td>';
						html = html + '</tr>';
					html = html + '</tfooter>';
				html = html + '</table>';

				html = html + '<div class="col col-md-12 items-end" id="payMembershipDuesPayButton" style="display: none !important; padding:0px !important; padding-top: 20px !important;">';
					html = html + '<a class="btn btn-success col col-md-12" onclick="payMembershipDues()">Pay Dues</a>';
				html = html + '</div>';
				console.log(html);
				$('#dueslisting').html(html);
				$('#dueslisting').show();
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
            log.error(e);
			toastr.error(data.message);
		}
	});
}


function getMembershipList()
{
	var selectedCoop = document.getElementById('duespaymentcooperative').value;
	console.log(selectedCoop);
	$.ajax({
		type: "GET",
		url: "/api/membership/"+selectedCoop,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$("#dueslisting").html("");
				$('#duespaymentsmember').empty();
				$('#duespaymentsmember').append($('<option>', {
					value: null,
					text : '--Select A Member--'
				}));
				$.each(data.list, function(key, value) {
					console.log(value);
					console.log(key);
					$('#duespaymentsmember').append($('<option>', {
						value: value.id,
						text : value.first_name + ' ' + value.last_name
					}));
				});
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}



var allFields = 1;
$( document ).ready(function() {

});

function pullcurrentsetup(coopId)
{
	//alert(33);
	var url = "/api/get-form-bio-data/" + coopId;
	console.log(url);

	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var reqdelementsFound = "";
				var otherDetails = data.list;
				console.log(otherDetails);
				$('#legendOtherDetails').html("Specify Details To Be Captured");
				var html = '<div style="padding: 10px !important; height: 10px !important;">&nbsp;</div>';
				if(otherDetails!=undefined && otherDetails!=null && otherDetails.length>0)
				{
					$('#legendOtherDetails').html("Other Details To Be Captured");
					html = html + '<fieldset style="border: 1px solid silver !important; padding: 20px 20px 20px">';
						html = html + '<legend style="width: auto !important; margin-bottom: 0px !important; border-bottom: 0 !important; font-size: 16px !important; font-weight: bold !important;">Existing Details</legend>';
						//html = html + '<p style="font-size: 15px !important; color: #000 !important; font-weight: bold; text-decoration: underline">Other Details</p>';
						html = html + '<div id="addCustomerDiv21" style="display: block !important;">';
							//html = html + '<p style="font-size: 15px !important; color: #000 !important">Other Details</p>';

							console.log((otherDetails).length);
							for(var v=0; v<(otherDetails).length; v++)
							{
								var otherDetail = otherDetails[v];
								console.log((otherDetail));
								if(otherDetail.showOrder!=undefined && minOrder<otherDetail.showOrder)
								{
									minOrder = otherDetail.showOrder;
								}

								if(otherDetail.showOrder>=maxOrder)
								{
									maxOrder = maxOrder + 20;
								}

								html = html + '<div style="clear: both; position: relative" id="bioEntryDiv'+otherDetail.id+'">';
									html = html + '<div id="processingDiv'+otherDetail.id+'" style="display: none !important; height: 100%;overflow-y: hidden; position: absolute; width: 100%; background-color: #f6f6f6 !important; text-align: center; justify-content: center; padding-top: 30px !important; margin: 0 !important;">';
										html = html + '<center>';
											html = html + '<img src="/images/loading-png-gif.gif" align="middle" style="height: 50px">';
											html = html + '<br>Processing...';
										html = html + '</center>';
									html = html + '</div>';


									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
									html = html + '<div class="col col-md-6 pull-left" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong style="text-decoration: underline !important;">Field #</strong>'+ (v+1);
									html = html + '</div>';

									html = html + '<div class="col col-md-5 pull-right" style="padding-right: 0px !important; text-align: right !important">';
										html = html + '<small><a style="cursor: pointer; text-decoration: underline !important; color: #fc0303 !important;" onclick="handleDeleteBioEntry('+ otherDetail.id +')"><i class="fa fa-trash"></i>Delete</a></small>';
									html = html + '</div>';

									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';


									html = html + '<div class="col col-md-6 pull-left" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Unique:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.uniqueYes==1 ? 'Yes' : 'No') + '</small>';
									html = html + '</div>';


									html = html + '<div class="col col-md-5 pull-right" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Compulsory:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.requiredYes==1 ? 'Yes' : 'No') + '</small>';
									html = html + '</div>';


									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
									html = html + '<div class="col col-md-6 pull-left" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Title of Field:</strong> &nbsp;&nbsp;<small>'+ otherDetail.title + '</small>';
									html = html + '</div>';

									html = html + '<div class="col col-md-5 pull-right" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Type of Field:</strong> &nbsp;&nbsp;<small>'+ otherDetail.fieldType + '</small>';
									html = html + '</div>';

									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
									html = html + '<div class="col col-md-6 pull-left" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Possible Values:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.options==undefined ? "N/A" : otherDetail.options.split('###').join(',')) + '</small>';
									html = html + '</div>';

									html = html + '<div class="col col-md-5 pull-right" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Minimum Length:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.minimumLength==undefined ? "N/A" : otherDetail.minimumLength) + '</small>';
									html = html + '</div>';
									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';

									html = html + '<div class="col col-md-6 pull-left" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Maximum Length:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.maximumLength==undefined ? "N/A" : otherDetail.maximumLength) + '</small>';
									html = html + '</div>';

									html = html + '<div class="col col-md-5 pull-right" style="padding-right: 0px !important; text-align: left !important">';
										html = html + '<strong>Display Order:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.showOrder==undefined ? "N/A" : otherDetail.showOrder) + '</small>';
									html = html + '</div>';
									html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';

									html = html + '<div class="col col-md-12" style="padding-right: 0px !important; text-align: left !important; padding-bottom: 10px">';
										html = html + '<strong>Description:</strong> &nbsp;&nbsp;<small>'+ (otherDetail.placeholder==undefined ? "N/A" : otherDetail.placeholder) + '</small>';
									html = html + '</div>';
									html = html + '<div style="border-top: 2px #000 solid; clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';

								html = html + '</div>';

							}
							//html = html + '<div class="flex flex-1 items-end">';
								//html = html + '<a class="btn btn-success col col-md-12" onclick="handleSubmitCustomerFormStepTwo()">Submit</a>';
							//html = html + '</div>';
						html = html + '</div>';
						//html = html + '<div class="col col-md-12">';
							//html = html + '<a class="btn btn-danger col col-md-3 pull-right" style="float: left !important" onclick="handleDeleteBioForm()">Delete Existing Bio Form?</a>';
						//html = html + '</div>';
					html = html + '</fieldset>';
				}
				console.log(html);

				var newelement = document.createElement('DIV');
				newelement.innerHTML = html;
				var allfields_ = document.getElementById('existingdetailsdiv');
				allfields_.appendChild(newelement);
				$('#existingdetailsdiv').show();
				updateMaxShowOrder();
			}
			else
			{
				//toastr.error(data.message);
			}
		},
		error: function (e) {
			console.log(e);
			toastr.error(e);
		}
	});
}

function updateMaxShowOrder()
{
	var showOrders = $('.fieldorderclass');
	showOrders.each(function()
	{
		console.log(this);
		var currval = this.value;
		$(this).empty();
		$(this).append($('<option>', {
			value: null,
			text : '--Field Order--'
		}));


		if(maxOrder<currval)
		{
			maxOrder = maxOrder + 20;
		}
		for(var k1=(minOrder+1); k1<maxOrder; k1++)
		{
			$(this).append($('<option>', {
				value: k1,
				text : k1,
				selected: k1==currval ? true : false
			}));
		}
	});

}


function customerotherdetailsetup()
{
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Customer Registration Form Setup';
	$( ".floater" ).hide();
	$( "#customerotherdetailsetup" ).show();
	var coopId = $('#cooperative_new_customer').val();

	pullcurrentsetup(coopId);

	$('#existingdetailsdiv').html("");
	var html = '';
	html = html + '<fieldset style="border: 1px solid silver !important; padding: 20px 20px 20px; padding-top: 0pc !important;">';
		html = html + '<legend style="width: auto !important; margin-bottom: 0px !important; border-bottom: 0 !important; font-size: 16px !important; font-weight: bold !important;" id="legendOtherDetails">Other Details</legend>';
		html = html + '<div class="col col-md-5 text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="bvn" style="float: right !important; padding-left: 0px !important">';
			html = html + '<a onclick="addNewField()" class="pull-right" style="pointer: cursor !important; font-size: 100 !important; text-decoration: underline !Important; color: #0331fc !important; cursor: pointer !important">Click to Add Field [+]</a>';
		html = html + '</div>';
		html = html + '<div class="mb-8 relative" style="clear: both !important;" id="allfields">';
			html = html + '<div class="col col-md-12" id="entry1" style="padding-left: 0px !important; padding-right: 0px !important; background-color: #f7f8fa !important;">';
				html = html + '<label class="col col-md-12 text-xs leading-loose mb-1 text-gray-700 font-bold font-display" for="bvn">';
					html = html + '<div class="col col-md-3 pull-left" style="padding-left: 0px !important;">';
						html = html + 'Field #1';
					html = html + '</div>';

					html = html + '<div class="col pull-right" style="padding-right: 0px !important; text-align: right !important">';
						html = html + '<input class="textfieldclass col" style="margin-right: 0px !important; float: right !important" name="required[]" placeholder="" id="required1" type="checkbox" value="1">';
						html = html + 'Compulsory&nbsp;&nbsp;';
					html = html + '</div>';

					html = html + '<div class="col pull-right" style="padding-right: 10px !important; text-align: right !important">';
						html = html + '<input class="textfieldclass col" style="margin-right: 0px !important; float: right !important" name="unique[]" placeholder="" id="unique1" type="checkbox" value="1">';
						html = html + 'Unique&nbsp;&nbsp;';
					html = html + '</div>';
				html = html + '</label>';
				html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
				html = html + '<select class="textfieldclass col col-md-5 typeselect" onchange="handleTypeSelect(1)" style="margin-right: 0px !important; float: left !important" name="fieldtype[]" id="fieldtype1">';
					html = html + '<option value="-1">--Type of Field--</option>';
					html = html + '<option value="SELECT">Drop Down Options</option>';
					html = html + '<option value="TEXTFIELD">Single Line Text</option>';
					html = html + '<option value="NUMBERFIELD">Numbers</option>';
					html = html + '<option value="TELEPHONEFIELD">Telephones</option>';
					html = html + '<option value="EMAILFIELD">Emails</option>';
					html = html + '<option value="DATE">Dates</option>';
					html = html + '<option value="TEXTAREA">Multi-line Text</option>';
					html = html + '<option value="RADIO">Single Option</option>';
					html = html + '<option value="CHECKBOX">Multiple Option</option>';
					html = html + '<option value="FILE">File Uploader</option>';
				html = html + '</select>';
				html = html + '<input class="textfieldclass col col-md-6" style="margin-right: 0px !important; float: right !important" name="title[]" placeholder="Title of field" id="title1" type="text" value="">';
				html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
				html = html + '<input title="Seperate values using ### example MALE###FEMALE" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: left !important" name="options[]" placeholder="Possible Values" id="options1" type="text" value="">';

				html = html + '<div class="col col-md-3 pull-right" style="padding-right: 0px !important">';
					html = html + '<input title="Example 10 means maximum of 10. Leave empty if not applicable" class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important" name="max[]" placeholder="Max Length" id="max1" type="text" value="">';
				html = html + '</div>';

				html = html + '<div class="col col-md-3 pull-right" style="padding-left: 0px !important">';
					html = html + '<input title="Example 3 means minimum of 3. Leave empty if not applicable" class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important" name="min[]" placeholder="Min Length" id="min1" type="text" value="">';
				html = html + '</div>';
				html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
				html = html + '<input title="Provide a description of this field for users" class="textfieldclass col col-md-5" style="margin-right: 0px !important; float: left !important" name="placeholder[]" placeholder="Enter Description Of Field" id="placeholder1" type="text" value="">';
				html = html + '<select class="textfieldclass col col-md-6 fieldorderclass" style="margin-right: 0px !important; float: right !important" id="order1" name="order[]">';
					html = html + '<option value="-1">--Field Order--</option>';
					console.log(minOrder+1);
					for(count=(minOrder+1); count<31; count++)
					{
						html = html + '<option value="' + count + '">' + count + '</option>';
					}
				html = html + '</select>';
				html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
			html = html + '</div>';


			html = html + '<div style="clear: both !important; padding: 0px !important; height: 4px !important; font-size: 4px !important">&nbsp;</div>';

		html = html + '</div>';
	html = html + '</fieldset>';
	$('#formbuilder').html(html);
	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}

function handleSubmitBioForm()
{
	var form = $('#customerotherdetailsetup')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/create-new-bio-form-setup",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				handleClose();
				toastr.success(data.message);

			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error('We could not create the new Cooperative. Please try again');
		}
	});
}


function handleValidateBioForm()
{
	var form = $('#customerotherdetailsetup')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		enctype: 'multipart/form-data',
		url: "/api/create-new-bio-form-setup",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				$( "#step_two_cooperative_id" ).val(data.cooperative_id);
				$( "#step_three_cooperative_id" ).val(data.cooperative_id);
				$( "#steponecooperative" ).hide();
				$( "#stepthreecooperative" ).hide();
				$( "#steptwocooperative" ).hide();
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});
				toastr.success(data.message);

			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error('We could not create the new Cooperative. Please try again');
		}
	});
}


$('#loginusername').keydown(function (e){
	//console.log(e.keyCode);
    if(e.keyCode == 13){
        signInToPortal();
    }
});


$('#loginpassword').keydown(function (e){
	//console.log(e.keyCode);
    if(e.keyCode == 13){
        signInToPortal();
    }
});


function handleDeleteBioEntry(id)
{
	var processingDiv = '#processingDiv' + id;
	var bioEntryDiv = '#bioEntryDiv' + id;
	$(processingDiv).show();
	var url = "/api/delete-form-bio-data-entry/" + id;
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$(processingDiv).hide();
				$(bioEntryDiv).remove();
			}
			else
			{
				$(processingDiv).hide();
				toastr.error(data.message);
			}
		},
		error: function (e) {
			$(processingDiv).hide();
			toastr.error('The field could not be removed');
		}
	});
}





function viewMember(id, verifyButton, editButton)
{
	//$( "#newCompany" ).show('slow', 'swing');
	$.ajax({
		type: "GET",
		url: "/api/get-customer-form-bio-data/" + id,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				document.getElementById('actionTitle').innerHTML = 'View Member Profile';

				$( ".floater" ).show();
				$( "#viewmemberprofilediv" ).show();
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});

				var otherDetails = data.list!=undefined ? data.list : null;
				console.log(otherDetails);
				var html = "";
				//html = html + '<p style="font-size: 15px !important; color: #000 !important; font-weight: bold; text-decoration: underline">Other Details</p>';
				//html = html + '<div id="addCustomerDiv23" style="display: block !important;">';
					//html = html + '<p style="font-size: 15px !important; color: #000 !important">Other Details</p>';

					console.log(otherDetails==null ? '' : (otherDetails).length);
					html = html + '<p style="font-size: 15px !important; color: #000 !important; font-weight: bold; text-decoration: underline">Primary Details</p>';
					html = html + '<div class="mb-8 relative">';
						html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Full Name</label>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
						html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: left !important">' + data.userprofile.firstName + ' ' + data.userprofile.lastName + '</div>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.userprofile.phoneNumber!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Phone Number</label>';
						if(data.userprofile.phoneNumber!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: left !important">' + data.userprofile.phoneNumber + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.userprofile.emailAddress!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Email Address</label>';
						if(data.userprofile.emailAddress!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.userprofile.emailAddress + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.userprofile.identificationType!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Means Of Identification</label>';
						if(data.userprofile.identificationType!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.userprofile.identificationType.split('_').join(' ') + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.userprofile.identificationNumber!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Identification Number</label>';
						if(data.userprofile.identificationNumber!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.userprofile.identificationNumber + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
					html = html + '<div class="mb-8 relative">';
						if(data.userrole.status!=undefined)
							html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display" style="float: left !important" for="bvn">Status</label>';
						if(data.userrole.status!=undefined)
							html = html + '<div class="textfieldclass col col-md-12" style="margin-right: 0px !important; float: right !important">' + data.userrole.status + '</div>';
					html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					html = html + '</div>';

					if(otherDetails!=null && (otherDetails).length>0)
					{
						html = html + '<p style="font-size: 15px !important; color: #000 !important; font-weight: bold; text-decoration: underline">Other Details</p>';

						for(var v=0; v<(otherDetails).length; v++)
						{
							var otherDetail = otherDetails[v];
							console.log((otherDetail));


							if(otherDetail.fieldType=='SELECT' || otherDetail.fieldType=='TEXTFIELD' || otherDetail.fieldType=='NUMBERFIELD' ||
								otherDetail.fieldType=='TELEPHONEFIELD' || otherDetail.fieldType=='EMAILFIELD' || otherDetail.fieldType=='DATE' ||
								otherDetail.fieldType=='RADIO' || otherDetail.fieldType=='CHECKBOX')
							{
								html = html + '<div class="flex flex-col mb-8 relative">';
									html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display">' + otherDetail.title + '</label>';
									html = html + '<div class="textfieldclass col col-md-12">' + otherDetail.value + '</div>';
								html = html + '</div>';
							}

							if(otherDetail.fieldType=='TEXTAREA')
							{
								html = html + '<div class="flex flex-col mb-8 relative">';
									html = html + '<label class="text-xs leading-loose mb-1 text-gray-700 font-bold font-display">' + otherDetail.title + '</label>';
									html = html + '<div class="textfieldclass col col-md-12">' + otherDetail.value + '</div>';
								html = html + '</div>';
							}


						}
					}

					if(verifyButton!=undefined && verifyButton==true)
					{
						if(data.userrole.status=='Inactive')
						{
							html = html + '<div style="clear:both !important; padding-left: 0px !important" class="col col-md-5" id="verifyProfileDiv">';
								html = html + '<a class="btn btn-success col col-md-12" style="cursor: pointer !important" onclick="activateMember('+ id +')">Activate Member</a>';
							html = html + '</div>';
						}
						else if(data.userrole.status=='Active')
						{
							html = html + '<div style="clear:both !important; padding-left: 0px !important" class="col col-md-5" id="deactivateProfileDiv">';
								html = html + '<a class="btn btn-danger col col-md-12" style="cursor: pointer !important" onclick="deactivateMember('+ id +')">Deactivate Member</a>';
							html = html + '</div>';
						}
					}
					if(editButton!=undefined && editButton==true)
					{
						html = html + '<div style="padding-right: 0px !important" class="col col-md-5 pull-right" id="editProfileDiv">';
							html = html + '<a class="btn btn-primary col col-md-12" style="cursor: pointer !important" onclick="editMember('+ id +', '+ data.userrole.cooperative_id +')">Edit Profile</a>';
						html = html + '</div>';
						html = html + '<div style="clear: both !important; padding: 0px !important; height: 2px !important; font-size: 2px !important">&nbsp;</div>';
					}
				//html = html + '</div>';
				console.log(html);
				var newelement = document.getElementById('viewCustomerDiv2');
				newelement.innerHTML = html;
				$('.floater').hide();
				$('#viewCustomerDiv2').show();
			}
			else
			{
				//toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}



function editMember(id, coopId)
{
	handleClose(1);
	setTimeout(
		function()
		{
			//handleSelector(coopId, id);
			$('#viewmemberprofilediv').hide();
			addNewMember(coopId, id);
		}
	, 1000);
}


function verifyMember(coopId, userRoleId, memberId)
{
	console.log(coopId);
	console.log(userRoleId);
	console.log(memberId);
	$.ajax({
		type: "GET",
		url: "/api/verify-member/" + userRoleId,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				var key = '#status' + memberId;
				$(key).html('Verified');
				key = '#membercheck' + memberId;
				$(key).hide();
				toastr.success(data.message);
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}



function activateMember(id)
{
	//$( "#newCompany" ).show('slow', 'swing');
	$.ajax({
		type: "GET",
		url: "/api/activate-member/" + id,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$( ".floater" ).hide();
				handleClose();
				toastr.success(data.message);
				var key = '#status' + id;
				$(key).html("Active");
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function deactivateMember(id)
{
	//$( "#newCompany" ).show('slow', 'swing');
	$.ajax({
		type: "GET",
		url: "/api/deactivate-member/" + id,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$( ".floater" ).hide();
				handleClose();
				toastr.success(data.message);
				var key = '#status' + id;
				$(key).html("Inactive");
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error("Error Experienced");
		}
	});
}



function deactivatePersonnel(id)
{
	//$( "#newCompany" ).show('slow', 'swing');
	$.ajax({
		type: "GET",
		url: "/api/deactivate-personnel/" + id,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$( ".floater" ).hide();
				handleClose();
				toastr.success(data.message);
				var key = '#st' + id;
				console.log(key);
				$(key).html("Inactive");
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error("Error Experienced");
		}
	});
}


function activatePersonnel(id)
{
	//$( "#newCompany" ).show('slow', 'swing');
	$.ajax({
		type: "GET",
		url: "/api/activate-personnel/" + id,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$( ".floater" ).hide();
				handleClose();
				toastr.success(data.message);
				var key = '#st' + id;
				$(key).html("Active");
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error("Error Experienced");
		}
	});
}







function payContribution(id)
{
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Add New Project';
	$( "#newcompanydiv" ).hide();
	$( "#newcustomerdiv" ).hide();
	$( "#customerotherdetailsetup" ).hide();
	$( "#newprojectdiv" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}

function handleInvestmentValuation(id)
{
	document.getElementById('actionTitle').innerHTML = 'Provide Investment Valuation';

	$( ".floater" ).hide();
	$( "#investmentvaliationform" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});


	var url = "/api/get-investments";
	console.log(url);
	$('#investment').empty();
	$('#investment').append($('<option>', {
		value: null,
		text : '--Select One--',
	}));
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$.each(data.data, function(key, value) {
					$('#investment').append($('<option>', {
						value: value.id,
						text : value.investmentCode + " - ZMW" + value.amount + ' (' + value.interestRate + '%, ' + value.investmentPeriod + ' days)',
					}));
				});
				$('#addCustomerDiv2').show();
				$('#addCustomerDiv2').show();
				$('#investment').val(id);
				loadPreviousValuations(id, 'investmentvaluation');
			}
			else
			{
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}


function loadPreviousValuations(id, divid)
{
	var url = "/api/get-investment-valuations/" + id;
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			$('#' + divid).html("");
			var html = "<b style='text-decoration: underline'>Previous Valuations Submitted</b>";
			if(data.status==0)
			{
				var noValuations = true;
				var indexer = 1;
				html = html + '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Date Valued</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Valuation (ZMW)</th>';
						html = html + '</tr>';
					html = html + '</thead>';
				html = html + '<tbody>';

				var lastValuation = 0.00;
				$.each(data.data, function(key, value) {

					html = html + '<tr>';
						html = html + '<td style="text-align: left !important;">' + indexer++ + '.</td>';
						html = html + '<td style="text-align: left !important;">' + value.createdAt + '</td>';
						html = html + '<td style="text-align: right !important;">' + value.valuation + '</td>';
					html = html + '</tr>';
					noValuations = false;
					lastValuation = value.valuation;
				});
					html = html + '</tbody>';
				html = html + '</table>';
				$('#lastvaluation').html("ZMW" + lastValuation);

				if(noValuations == true)
				{
					html = '<table class="table table-hover col col-md-12">';
						html = html + '<thead>';
							html = html + '<tr>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important;">Date Valued</th>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important;">Valuation (ZMW)</th>';
							html = html + '</tr>';
						html = html + '</thead>';
						html = html + '<tbody>';
							html = html + '<tr>';
								html = html + '<td colspan="3" style="text-align: center !important;">There are currently No Valuations Provided</td>';
							html = html + '</tr>';
						html = html + '</tbody>';
					html = html + '</table>';
				}
				$('#' + divid).html(html==undefined ? '' : html);
				console.log(html);
				$('#' + divid).show();

			}
			else
			{
				html = html + '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Valuation (ZMW)</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
						html = html + '<tr>';
							html = html + '<td colspan="2" style="text-align: center !important;">There are currently No Valuations Provided</td>';
						html = html + '</tr>';
					html = html + '</tbody>';
				html = html + '</table>';
				$('#' + divid).html(html==undefined ? '' : html);
				console.log(html);
				$('#' + divid).show();
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}



function selectToTransferToInvestor()
{
	total = 0;
	totalFormatted = 0.00;
	allCheckboxes = $('.transferToInvestor');
	allCheckboxes.each(function (index, obj) {
		if (obj.checked === true) {
			var val = obj.value;
			val = parseFloat(val.split('###')[1]);
			console.log(val);
			total = total + (val);
			console.log('total = ' + total);
			totalFormatted = Number.parseFloat(total).toFixed(2);
			const options1 = { style: 'currency', currency: 'ZMW' };
			const numberFormat1 = new Intl.NumberFormat('en-US', options1);
			totalFormatted = numberFormat1.format(totalFormatted);
		}
		$('#totalSelectedToTransfer').html(totalFormatted)
		if(total>0)
			$('#transferToInvestorButton').show();
		else
			$('#transferToInvestorButton').hide();
	});
}


function loadInvestorDividends(id, divid)
{
	var url = "/api/get-investment-dividends/" + id;
	console.log(url);
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			$('#' + divid).html("");
			var html = "<b style='text-decoration: underline'>Project Member Dividends</b>";
			if(data.status==0)
			{
				var dividends = data.dividends;
				console.log(dividends);
				var noValuations = true;
				var indexer = 1;
				html = html + '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;"><input type="checkbox" class="selectall" onchange="javascript:handleSelectAll(); selectToTransferToInvestor()" id="selectall" value="1"></th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Project Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Invested (ZMW)</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Returns (ZMW)</th>';
						html = html + '</tr>';
					html = html + '</thead>';
				html = html + '<tbody>';

				var lastValuation = 0.00;
				var ratioSum = 0;
				var principalTotal = 0;
				var returnTotal = 0;
				var available = 0;
				$.each(data.data, function(key, value) {


					console.log(value);
					html = html + '<tr>';
						html = html + '<td style="text-align: left !important;" id="tdId'+ value.memberId +'">';
						if(dividends.includes(value.memberId))
						{
							html = html + 'P';
						}
						else
						{
							available++;
							html = html + '<input type="checkbox" class="checker transferToInvestor" onclick="javascript:selectToTransferToInvestor()" name="transferToInvestor[]" id="transferToInvestor" value="'+ value.memberId +'###'+ (value.principal_paid + value.interest_paid) +'">';
						}

							html = html + '</td>';
						html = html + '<td style="text-align: left !important;">' + value.memberName + '</td>';
						html = html + '<td style="text-align: right !important;">' + value.principal + ' (' + value.share_ratio + '%)</td>';
						html = html + '<td style="text-align: right !important;">' + (value.principal_paid + value.interest_paid) + '</td>';
					html = html + '</tr>';
					ratioSum = ratioSum + value.share_ratio;
					principalTotal = principalTotal + value.principal;
					returnTotal = returnTotal + value.principal_paid + value.interest_paid;
					noValuations = false;
				});
				if(noValuations == false)
				{
					html = html + '<tr>';
						html = html + '<td style="text-align: left !important; background-color: #000 !important; color: #fff !important; " colspan="2">Total</td>';
						html = html + '<td style="text-align: right !important; background-color: #000 !important; color: #fff !important; ">' + principalTotal + ' (' + ratioSum + '%)</td>';
						html = html + '<td style="text-align: right !important; background-color: #000 !important; color: #fff !important; ">' + Math.ceil(returnTotal) + '</td>';
					html = html + '</tr>';
					if(available>0)
					{
						html = html + '<tr>';
							html = html + '<td style="text-align: left !important; background-color: #000 !important; color: #fff !important; " colspan="3">Total Selected</td>';
							html = html + '<td id="totalSelectedToTransfer" style="text-align: right !important; background-color: #000 !important; color: #fff !important; ">ZMW0.00</td>';
						html = html + '</tr>';

						html = html + '<tr id="transferToInvestorButton" style="display:none !important">';
							html = html + '<td colspan="3">';
								html = html + '&nbsp;';
							html = html + '</td>';

							html = html + '<td style="text-align: right !important">';
								html = html + '<a class="btn btn-success col col-md-12 pull-right" onclick="submitDividendsForms()">Transfer Dividends to Project Members</a>';
							html = html + '</td>';
						html = html + '</tr>';
					}
				}
					html = html + '</tbody>';
				html = html + '</table>';
				$('#lastvaluation').html("ZMW" + lastValuation);

				if(noValuations == true)
				{
					html = '<table class="table table-hover col col-md-12">';
						html = html + '<thead>';
							html = html + '<tr>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important;">Project Member</th>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Invested (ZMW)</th>';
								html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Returns (ZMW)</th>';
							html = html + '</tr>';
						html = html + '</thead>';
						html = html + '<tbody>';
							html = html + '<tr>';
								html = html + '<td colspan="4" style="text-align: center !important;">There are currently No Payable Dividends</td>';
							html = html + '</tr>';
						html = html + '</tbody>';
					html = html + '</table>';
				}
				$('#' + divid).html(html==undefined ? '' : html);
				console.log(html);
				$('#' + divid).show();

			}
			else
			{
				html = '<table class="table table-hover col col-md-12">';
					html = html + '<thead>';
						html = html + '<tr>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">S/N</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important;">Project Member</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Invested (ZMW)</th>';
							html = html + '<th style="background-color: #000 !important; color: #fff !important; text-align: right !important;">Returns (ZMW)</th>';
						html = html + '</tr>';
					html = html + '</thead>';
					html = html + '<tbody>';
						html = html + '<tr>';
							html = html + '<td colspan="4" style="text-align: center !important;">There are currently No Payable Dividends</td>';
						html = html + '</tr>';
					html = html + '</tbody>';
				html = html + '</table>';
				$('#' + divid).html(html==undefined ? '' : html);
				console.log(html);
				$('#' + divid).show();
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}



function submitDividendsForms()
{
	var form = $('#payinvestordividendsform')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		url: "/api/submit-investment-dividends",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				processedEntries = data.data;
				for(var i1=0; i1<processedEntries.length; i1++)
				{
					divId = '#tdId' + processedEntries[i1];
					$(divId).html("P")
					$('#totalSelectedToTransfer').html("ZMW0.00");
				}
				var keyValId = '#investmentstatus'+$('#payinvestordividends').val();
				$(keyValId).html(data.status);
				$('#viewinvestordividends').hide();
				toastr.success(data.message);
				handleClose();
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}



function submitValuationForm()
{
	var form = $('#investmentvaliationform')[0];
	var data = new FormData(form);
	console.log(data);
	$.ajax({
		type: "POST",
		url: "/api/submit-investment-valuation",
		data: data,
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			if(data.status==0)
			{
				var keyValId = '#lastValuation'+$('#investment').val();
				$(keyValId).html(data.lastValuation);
				$('#investment').empty();
				$('#valuation').val("");
				toastr.success(data.message);
				handleClose();
			}
			else
			{
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(data.message);
		}
	});
}


function handleViewPayInvestmentDividends(id)
{
	document.getElementById('actionTitle').innerHTML = 'Investor Dividends';

	$( ".floater" ).hide();
	$( "#payinvestordividendsform" ).show();


	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});


	var url = "/api/get-investments";
	console.log(url);
	$('#payinvestordividends').empty();
	$('#payinvestordividends').append($('<option>', {
		value: null,
		text : '--Select One--',
	}));
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$.each(data.data, function(key, value) {
					$('#payinvestordividends').append($('<option>', {
						value: value.id,
						text : value.investmentCode + " - ZMW" + value.amount + ' (' + value.interestRate + '%, ' + value.investmentPeriod + ' days)',
					}));
				});
				$('#payinvestordividends').val(id);
				loadInvestorDividends(id, 'viewinvestordividends');
			}
			else
			{
				$("#newCompany").show();
				$("#addbvn-modal-container").show();
				$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

				}});
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}



function handleNewProject()
{
	//$( "#newCompany" ).show('slow', 'swing');
	document.getElementById('actionTitle').innerHTML = 'Setup A New Project';
	//$( "#steponecooperative" ).hide();
	//$( "#newcustomerdiv" ).hide();
	//$( "#customerotherdetailsetup" ).hide();
	$( ".floater" ).hide();
	$( "#newprojectdiv" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});
}


function handleSlotIntervalTypeChange()
{
	console.log($('#slot_every_only').val());
	if($('#slot_every_only').val()=='Every')
	{
		$('#slot_amount').show();
		$('#slot_interval_type').show();
		$('#slot_interval').show();
	}
	else if($('#slot_every_only').val()=='Once')
	{
		$('#slot_amount').show();
		$('#slot_interval_type').hide();
		$('#slot_interval').hide();
	}
	else
	{
		$('#slot_amount').hide();
		$('#slot_interval_type').hide();
		$('#slot_interval').hide();
	}
}

function handlePenaltyTypeChange()
{
	if($('#penalty_type').val()=='FLAT_FEE')
	{
		document.getElementById('penalty').style = "background-repeat: no-repeat; background-position: right !important; background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='50px' width='120px'><text x='65%' y='25' fill='black' font-size='10'>ZMW</text></svg>\"); margin-left: 0px !important;";
	}
	else if($('#penalty_type').val()=='PERCENTAGE_OF_AMOUNT')
	{
		document.getElementById('penalty').style = "background-repeat: no-repeat; background-position: right !important; background-image: url(\"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='50px' width='120px'><text x='65%' y='25' fill='black' font-size='10'>(%)</text></svg>\"); margin-left: 0px !important;";
	}
	else
	{
		document.getElementById('penalty').style = 'background-repeat: no-repeat; background-position: right !important; ';
	}


}


$('#penaltyApplicable').on('change', function()
{
	console.log($('#penaltyApplicable').is(":checked"));
	if($('#penaltyApplicable').is(":checked")==true)
	{
		$('#penalty').show();
		$('#penalty_type').show();
	}
	else
	{
		$('#penalty').hide();
		$('#penalty_type').hide();
	}
});




function handleSelectAll()
{
	if($('.selectall').is(":checked")==true)
	{
		$('.checker').prop('checked', true);
	}
	else
	{
		$('.checker').prop('checked', false);
	}
}

$('.selectall').on('change', function(){
	console.log(332323);
	if($('.selectall').is(":checked")==true)
	{
		console.log(33);
		$('.checker').prop('checked', true);
	}
	else
	{
		console.log(311);
		$('.checker').prop('checked', false);
	}
});



function submitNewProject()
{
	var new_project_cooperative = $('#new_project_cooperative').val();
	var new_project_wealth_manager = $('#new_project_wealth_manager').val();
	var project_name = $('#project_name').val();
	var slots = $('#slots').val();
	var slot_amount = $('#slot_amount').val();
	var slot_every_only = $('#slot_every_only').val();
	var slot_interval_type = $('#slot_interval_type').val();
	var slot_interval = $('#slot_interval').val();
	var slot_period = $('#slot_period').val();
	var min_slot_period = $('#min_slot_period').val();
	var max_slot_period = $('#max_slot_period').val();
	var description = $('#description').val();
	var penalty = $('#penalty').val();
	var penalty_type = $('#penalty_type').val();
	var penaltyApplicable = $('#penaltyApplicable').val();

	var proceed = false;
	var errorMsg = null;
	if(new_project_cooperative.length>0 && project_name.length>0 && slots>0 && slot_amount>0 && slot_every_only.length>0 &&
		slot_period>0 && min_slot_period>0)
	{
		proceed = true;
		if((slot_every_only=='Every' && slot_interval.length>0 && slot_interval_type.length>0) || (slot_every_only=='Once'))
		{
			console.log($('#penaltyApplicable').checked);
			console.log(penalty_type);
			console.log(penalty);
			if($('#penaltyApplicable').checked==true && penalty_type.length>0 && penalty.length>0)
			{
				/*Package for 50000 Broiler Chickens Production Investment Programme.
Minimum chickens purchasable is 10 chickens
Maximum chickens purchasable is 500 chickens.
K35 per Bird*/
			}
			else
			{
				if($('#penaltyApplicable').checked==true)
				{
					proceed = false;
					errorMsg = "If there is a penalty for failing to pay, please provide details of this penalty";
				}
			}
		}
		else
		{
			proceed = false;
			errorMsg = "Please provide the details of the slot interval payment";
		}
	}
	else
	{
		proceed = false;
		errorMsg = "All details with a red asterisk must be provided";
	}

	if(proceed===true)
	{
		var form = $('#newprojectdiv')[0];
		var data = new FormData(form);
		console.log(data);
		$.ajax({
			type: "POST",
			enctype: 'multipart/form-data',
			url: "/api/create-new-project",
			data: data,
			processData: false,
			contentType: false,
			cache: false,
			timeout: 600000,
			success: function (data) {
				if(data.status==0)
				{
					//$( "#newprojectdiv" ).hide();
					//$( "#startprojectdiv" ).show();
					//$( '#projectid' ).val(data.project_id);
					//$( '#project_title_activate' ).html(data.project_title);
					handleClose();
					if(data.project_id!=undefined && data.project_id!=null)
					{

					}
					else
					{
						handleActivateProject(data.project_id, data.project_title);
					}
					toastr.success(data.message);

				}
				else
				{
					toastr.error(data.message);
				}
			},
			error: function (e) {
				toastr.error(data.message);
			}
		});
	}
	else
	{
		toastr.error(errorMsg);
	}
}


$('#every_only').on('change', function()
{
	console.log($('#every_only').val());
	if($('#every_only').val()=='Every')
	{
		$('#membershipinterval').show();
		$('#membershipfees').show();
		$('#membershipintervaltype').show();
		//alert(33);
		$('#membershipintervaltype').empty();
		var intervaltypes = {'DAY':'Days', 'WEEK':'Weeks', 'MONTH':'Months', 'YEAR':'Years'};
		$.each(intervaltypes, function(key, value)
		{
			$('#membershipintervaltype').append($('<option>', {
				value: key,
				text : value
			}));
		});
	}
	else if($('#every_only').val()=='Once')
	{
		$('#membershipinterval').hide();
		$('#membershipfees').show();
		$('#membershipintervaltype').hide();
	}
	else
	{
		$('#membershipinterval').hide();
		$('#membershipfees').hide();
		$('#membershipintervaltype').hide();
	}
});



function handleViewInvestmentValuation(id)
{
	document.getElementById('actionTitle').innerHTML = 'Investment Valuations';

	$( ".floater" ).hide();
	$( "#viewinvestmentvaliationform" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});

	var url = "/api/get-investments";
	console.log(url);
	$('#viewvaluationinvestment').empty();
	$('#viewvaluationinvestment').append($('<option>', {
		value: null,
		text : '--Select One--',
	}));
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$.each(data.data, function(key, value) {
					$('#viewvaluationinvestment').append($('<option>', {
						value: value.id,
						text : value.investmentCode + " - ZMW" + value.amount + ' (' + value.interestRate + '%, ' + value.investmentPeriod + ' days)',
					}));
				});
				$('#viewvaluationinvestment').val(id);
				loadPreviousValuations(id, 'viewinvestmentvaluation');
			}
			else
			{
				handleClose();
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}


function handleReturnValuation(id)
{
	document.getElementById('actionTitle').innerHTML = 'Repay Returns On Investment';

	$( ".floater" ).hide();
	$( "#returninvestmentvaliationform" ).show();

	$("#newCompany").show();
	$("#addbvn-modal-container").show();
	$("#addbvn-modal-container").animate({"right": "0px"}, {duration: 1000, complete: function () {

	}});

	$('#returnsAmount').val("");
	$('#returnsValuation').val("");
	var url = "/api/get-investments";
	console.log(url);
	$('#returninvestment').empty();
	$('#returninvestment').append($('<option>', {
		value: null,
		text : '--Select One--',
	}));
	$.ajax({
		type: "GET",
		url: url,
		data: [],
		processData: false,
		contentType: false,
		cache: false,
		timeout: 600000,
		success: function (data) {
			console.log(data);
			if(data.status==0)
			{
				$.each(data.data, function(key, value) {
					$('#returninvestment').append($('<option>', {
						value: value.id,
						text : value.investmentCode + " - ZMW" + value.amount + ' (' + value.interestRate + '%, ' + value.investmentPeriod + ' days)',
						selected: value.id==id ? true : false
					}));
				});
				loadPreviousValuations(id, 'returninvestmentvaluation');
			}
			else
			{
				handleClose();
				toastr.error(data.message);
			}
		},
		error: function (e) {
			toastr.error(e);
		}
	});
}
